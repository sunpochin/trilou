/**
 * ğŸ­ Factory Pattern = å·¥å» ç”Ÿç”¢ç·š
 * 
 * ğŸ¤” æƒ³åƒä½ è¦åšå¾ˆå¤šç©å…·è»Šï¼š
 * 
 * âŒ æ²’æœ‰å·¥å» çš„ä¸–ç•Œï¼š
 * - æ¯æ¬¡è¦è»Šå­ï¼Œä½ å°±è‡ªå·±åšï¼šæ‰¾è¼ªå­ã€è»Šèº«ã€è²¼è²¼ç´™...
 * - æ¯å€‹äººåšå‡ºä¾†çš„è»Šå­éƒ½ä¸ä¸€æ¨£ï¼ˆæœ‰äº›å¿˜è¨˜è²¼è²¼ç´™ï¼Œæœ‰äº›è¼ªå­è£æ­ªï¼‰
 * - å¦‚æœè¦æ”¹è»Šå­çš„é¡è‰²ï¼Œè¦è·Ÿæ¯å€‹äººèªªæ€éº¼æ”¹
 * 
 * âœ… æœ‰å·¥å» çš„ä¸–ç•Œï¼š
 * - è·Ÿå·¥å» èªªã€Œæˆ‘è¦ä¸€å°ç´…è‰²è»Šå­ã€
 * - å·¥å» çŸ¥é“æ‰€æœ‰æ­¥é©Ÿï¼šè£è¼ªå­ â†’ è£è»Šèº« â†’ è²¼è²¼ç´™ â†’ å“è³ªæª¢æŸ¥
 * - æ¯å°è»Šå­éƒ½ä¸€æ¨¡ä¸€æ¨£ï¼Œå“è³ªç©©å®š
 * - è¦æ”¹é¡è‰²ï¼Ÿåªè¦æ”¹å·¥å» çš„ç”Ÿç”¢ç·šå°±å¥½
 * 
 * ğŸ¯ é€™å€‹æª”æ¡ˆå°±æ˜¯ã€Œå¡ç‰‡å’Œåˆ—è¡¨çš„å·¥å» ã€ï¼š
 * - æƒ³è¦æ–°å¡ç‰‡ï¼Ÿå·¥å» å¹«ä½ åšï¼šçµ¦ IDã€è¨­æ™‚é–“ã€æª¢æŸ¥æ ¼å¼
 * - æƒ³è¦æ–°åˆ—è¡¨ï¼Ÿå·¥å» å¹«ä½ åšï¼šçµ¦ IDã€è¨­é è¨­å€¼ã€å»ºç«‹ç©ºçš„å¡ç‰‡é™£åˆ—
 * - æƒ³è¦è¤‡è£½å¡ç‰‡ï¼Ÿå·¥å» å¹«ä½ åšï¼šè¤‡è£½åŸæœ¬çš„ï¼Œä½†çµ¦æ–°çš„ ID
 * 
 * ğŸ¤·â€â™‚ï¸ ã€è¶…é‡è¦ã€‘èˆ‡ CardRepository.createCard æœ‰ä»€éº¼ä¸åŒï¼Ÿ
 * 
 * ğŸ§¸ EntityFactory.createCardï¼ˆé€™è£¡ï¼‰= ç©å…·ç©æœ¨å·¥å» 
 * - ç”¨ç©æœ¨åœ¨å®¶è£¡çµ„è£ä¸€å€‹ã€Œç©å…·å¡ç‰‡ã€
 * - åªæ˜¯å»ºç«‹è¨˜æ†¶é«”ä¸­çš„å‡ç‰©ä»¶ï¼Œä¸æœƒå­˜åˆ°è³‡æ–™åº«
 * - å°±åƒåœ¨ç´™ä¸Šç•«ä¸€å¼µå¡ç‰‡ï¼Œé‚„æ²’çœŸæ­£å°å‡ºä¾†
 * - ç”¨é€”ï¼šæ¨‚è§€ UI æ›´æ–°æ™‚å»ºç«‹ã€Œæš«æ™‚å¡ç‰‡ã€è®“ç”¨æˆ¶å…ˆçœ‹åˆ°
 * 
 * ğŸª CardRepository.createCard = çœŸæ­£çš„å¡ç‰‡å°åˆ·å» 
 * - æ‰“é›»è©±çµ¦å°åˆ·å» ï¼ŒçœŸçš„å°å‡ºä¸€å¼µå¯¦é«”å¡ç‰‡
 * - æœƒå‘¼å« APIï¼ŒæŠŠå¡ç‰‡å­˜åˆ°è³‡æ–™åº«è£¡
 * - å°±åƒçœŸçš„å»å°åˆ·åº—å°åç‰‡ï¼Œæœƒæœ‰çœŸå¯¦çš„ç”¢å“
 * - ç”¨é€”ï¼šæŠŠå¡ç‰‡çœŸæ­£å­˜åˆ°å¾Œç«¯è³‡æ–™åº«
 * 
  ğŸ¯ åæ­²å­©ç«¥æ¯”å–»

  EntityFactory = åœ¨ç´™ä¸Šç•«ä¸€å¼µå‡éˆ”
  - ä½ ç«‹åˆ»å°±èƒ½çœ‹åˆ°ã€ŒéŒ¢ã€
  - ä½†ä¸èƒ½çœŸçš„æ‹¿å»è²·æ±è¥¿
  - åªæ˜¯å…ˆè®“ä½ çˆ½ä¸€ä¸‹ ğŸ˜„

  CardRepository = å»éŠ€è¡Œé ˜çœŸéˆ”
  - è¦æ’éšŠç­‰å¾…éŠ€è¡Œè™•ç†
  - ä½†é ˜åˆ°çš„æ˜¯çœŸéŒ¢ï¼Œå¯ä»¥è²·æ±è¥¿
  - é›–ç„¶æ…¢ï¼Œä½†æ˜¯æœ‰åƒ¹å€¼çš„

  ğŸ”„ å¯¦éš›é‹ä½œæµç¨‹

  ç”¨æˆ¶é»ã€Œæ–°å¢å¡ç‰‡ã€
        â†“
  1. EntityFactory åšå‡å¡ç‰‡ âš¡ï¼ˆç«‹åˆ»é¡¯ç¤ºï¼‰
        â†“
  2. CardRepository åšçœŸå¡ç‰‡ ğŸŒï¼ˆèƒŒæ™¯è™•ç†ï¼‰
        â†“
  3. æˆåŠŸï¼šå‡å¡ç‰‡ â†’ çœŸå¡ç‰‡ âœ…
     å¤±æ•—ï¼šå‡å¡ç‰‡ â†’ æ¶ˆå¤± âŒ

  é€™å°±æ˜¯ç‚ºä»€éº¼ä½ çš„ addCard
  ç¾åœ¨è®Šå¾—è¶…å¿«äº†ï¼ç”¨æˆ¶é»æŒ‰éˆ•ç«‹åˆ»çœ‹åˆ°å¡ç‰‡ï¼ˆå‡çš„ï¼‰ï¼Œç„¶å¾ŒèƒŒæ™¯æ‚„
  æ‚„åœ°æŠŠå®ƒè®ŠæˆçœŸçš„ã€‚å¦‚æœå¤±æ•—ï¼Œå‡å¡ç‰‡å°±æœƒæ¶ˆå¤±ï¼Œä¸¦é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
  ã€‚
  å°±åƒé­”è¡“ä¸€æ¨£ï¼šå…ˆè®Šå‡ºå‡èŠ±è®“è§€çœ¾é–‹å¿ƒï¼Œç„¶å¾Œæ‚„æ‚„æ›æˆçœŸèŠ±ï¼ğŸ©âœ¨  
 * ğŸ“‹ å¯¦éš›ä½¿ç”¨æµç¨‹ï¼š
 * 1. ç”¨æˆ¶é»ã€Œæ–°å¢å¡ç‰‡ã€
 * 2. EntityFactory.createCard â†’ åšå‡å¡ç‰‡ï¼ˆç”¨æˆ¶ç«‹åˆ»çœ‹åˆ°ï¼‰âš¡
 * 3. CardRepository.createCard â†’ åšçœŸå¡ç‰‡ï¼ˆèƒŒæ™¯å­˜è³‡æ–™åº«ï¼‰ğŸŒ
 * 4. æˆåŠŸï¼šæŠŠå‡å¡ç‰‡æ›æˆçœŸå¡ç‰‡ âœ…
 * 5. å¤±æ•—ï¼šæŠŠå‡å¡ç‰‡ä¸Ÿæ‰ âŒ
 * 
 * ğŸ›’ å°±åƒç¶²è³¼ï¼š
 * - EntityFactory = å…ˆåœ¨è³¼ç‰©è»Šè£¡åŠ å•†å“ï¼ˆé‚„æ²’çœŸçš„è²·ï¼‰
 * - CardRepository = æŒ‰ä¸‹çµå¸³ï¼ŒçœŸçš„ä»˜éŒ¢è²·ä¸‹ä¾†
 * 
 * ğŸ“ ä½¿ç”¨æ–¹å¼ï¼š
 * const newCard = EntityFactory.createCard({
 *   title: 'æˆ‘çš„æ–°å¡ç‰‡',
 *   listId: 'list-123'
 * })
 * // å·¥å» è‡ªå‹•å¹«ä½ åŠ ä¸Š IDã€æ™‚é–“ã€é è¨­å€¼ç­‰ç­‰
 * 
 * ğŸ’¡ ç°¡å–®èªªï¼šä¸è¦è‡ªå·±æ‰‹å·¥åšï¼Œç”¨å·¥å» çµ±ä¸€ç”Ÿç”¢ï¼Œå“è³ªæ¯”è¼ƒå¥½
 */

/**
 * ğŸ“‹ å¯¦é«”ä»‹é¢å®šç¾© - å°±åƒç”¢å“çš„è¨­è¨ˆåœ–
 * 
 * ğŸ¤” ç‚ºä»€éº¼è¦å®šç¾©é€™äº›ï¼Ÿ
 * - ç¢ºä¿æ¯å€‹å¡ç‰‡/åˆ—è¡¨/çœ‹æ¿éƒ½æœ‰ç›¸åŒçš„å±¬æ€§
 * - è®“ TypeScript å¹«æˆ‘å€‘æª¢æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¢º
 * - ç•¶ä½œã€Œè¦æ ¼æ›¸ã€ï¼Œå‘Šè¨´å·¥å» è¦ç”Ÿç”¢ä»€éº¼æ¨£çš„ç”¢å“
 */

// EntityFactory ä½¿ç”¨ API å‹åˆ¥ï¼Œå› ç‚ºè¦å»ºç«‹è³‡æ–™åº«å¯¦é«”
import type { Card } from '@/types/api'

import type { List } from '@/types/api'

// ä½¿ç”¨çµ±ä¸€çš„å‹åˆ¥å®šç¾©

import type { Board } from '@/types/api'

// ä½¿ç”¨çµ±ä¸€çš„å‹åˆ¥å®šç¾©

/**
 * ğŸ› ï¸ å»ºç«‹åƒæ•¸ä»‹é¢ - å·¥å» çš„ã€Œè¨‚å–®æ ¼å¼ã€
 * 
 * ğŸ¤” ç‚ºä»€éº¼è¦åˆ†é–‹å®šç¾©ï¼Ÿ
 * - ä½¿ç”¨è€…ä¸éœ€è¦æä¾›æ‰€æœ‰å±¬æ€§ï¼ˆæ¯”å¦‚ IDã€æ™‚é–“ç­‰å·¥å» æœƒè‡ªå‹•ç”Ÿæˆï¼‰
 * - åªè¦æ±‚å¿…è¦çš„è³‡è¨Šï¼Œè®“ä½¿ç”¨æ›´ç°¡å–®
 * - ? ç¬¦è™Ÿè¡¨ç¤ºå¯é¸ï¼Œæ²’æä¾›å°±ç”¨é è¨­å€¼
 */

// å»ºç«‹å¡ç‰‡æ™‚éœ€è¦çš„è³‡è¨Š
interface CreateCardParams {
  title: string        // å¿…å¡«ï¼šå¡ç‰‡æ¨™é¡Œ
  listId: string       // å¿…å¡«ï¼šè¦æ”¾åœ¨å“ªå€‹åˆ—è¡¨
  description?: string // å¯é¸ï¼šå¡ç‰‡æè¿°ï¼ˆæ²’æä¾›å°±æ˜¯ç©ºå­—ä¸²ï¼‰
  position?: number    // å¯é¸ï¼šä½ç½®ï¼ˆæ²’æä¾›å°±æ˜¯ 0ï¼‰
}

// å»ºç«‹åˆ—è¡¨æ™‚éœ€è¦çš„è³‡è¨Š
interface CreateListParams {
  title: string        // å¿…å¡«ï¼šåˆ—è¡¨æ¨™é¡Œ
  position?: number    // å¯é¸ï¼šä½ç½®ï¼ˆæ²’æä¾›å°±æ˜¯ 0ï¼‰
}

// å»ºç«‹çœ‹æ¿æ™‚éœ€è¦çš„è³‡è¨Š
interface CreateBoardParams {
  title: string        // å¿…å¡«ï¼šçœ‹æ¿æ¨™é¡Œ
  description?: string // å¯é¸ï¼šçœ‹æ¿æè¿°ï¼ˆæ²’æä¾›å°±æ˜¯ç©ºå­—ä¸²ï¼‰
}

export class EntityFactory {
  /**
   * ğŸ·ï¸ å»ºç«‹å¡ç‰‡ - å¡ç‰‡ç”Ÿç”¢ç·š
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - æ¥æ”¶ä½¿ç”¨è€…çš„ã€Œè¨‚å–®ã€ï¼ˆæ¨™é¡Œã€åˆ—è¡¨IDç­‰ï¼‰
   * - è‡ªå‹•ç”Ÿæˆå®Œæ•´çš„å¡ç‰‡ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦å±¬æ€§
   * - å°±åƒé»é¤ï¼šä½ èªªè¦ä»€éº¼ï¼Œå»šæˆ¿åšå‡ºå®Œæ•´çš„é¤é»
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * const newCard = EntityFactory.createCard({
   *   title: 'å¯¦ä½œç™»å…¥åŠŸèƒ½',
   *   listId: 'list_abc123',
   *   description: 'ä½¿ç”¨ Firebase Auth',
   *   position: 2
   * })
   * // çµæœæœƒå¾—åˆ°å®Œæ•´çš„å¡ç‰‡ï¼ŒåŒ…å«è‡ªå‹•ç”Ÿæˆçš„ ID å’Œæ™‚é–“
   * 
   * ğŸ’¡ å·¥å» è‡ªå‹•åšçš„äº‹ï¼š
   * - ç”Ÿæˆå”¯ä¸€çš„ ID
   * - è¨­å®šå»ºç«‹å’Œæ›´æ–°æ™‚é–“
   * - è™•ç†é è¨­å€¼ï¼ˆdescription å’Œ positionï¼‰
   * - æ¸…ç†æ¨™é¡Œï¼ˆå»é™¤å‰å¾Œç©ºç™½ï¼‰
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param params - å»ºç«‹å¡ç‰‡éœ€è¦çš„è³‡è¨Š
   * @returns å®Œæ•´çš„å¡ç‰‡ç‰©ä»¶
   */
  static createCard(params: CreateCardParams): Card {
    return {
      id: this.generateId('card'),               // è‡ªå‹•ç”Ÿæˆå”¯ä¸€ IDï¼Œæ ¼å¼ï¼šcard_xxxxx_xxxxx
      title: params.title.trim(),                // æ¸…ç†æ¨™é¡Œçš„å‰å¾Œç©ºç™½
      description: params.description || '',     // å¦‚æœæ²’æä¾›æè¿°ï¼Œå°±ç”¨ç©ºå­—ä¸²
      position: params.position ?? 0,            // å¦‚æœæ²’æä¾›ä½ç½®ï¼Œå°±ç”¨ 0ï¼ˆ?? æ˜¯ã€Œç©ºå€¼åˆä½µã€æ“ä½œç¬¦ï¼‰
      listId: params.listId,                     // æŒ‡å®šé€™å¼µå¡ç‰‡å±¬æ–¼å“ªå€‹åˆ—è¡¨
      createdAt: new Date(),                     // è‡ªå‹•è¨­å®šå»ºç«‹æ™‚é–“ç‚ºç¾åœ¨
      updatedAt: new Date()                      // è‡ªå‹•è¨­å®šæ›´æ–°æ™‚é–“ç‚ºç¾åœ¨
    }
  }

  /**
   * ğŸ“ å»ºç«‹åˆ—è¡¨ - åˆ—è¡¨ç”Ÿç”¢ç·š
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - å»ºç«‹ä¸€å€‹æ–°çš„ç©ºåˆ—è¡¨
   * - è‡ªå‹•è¨­å®šæ‰€æœ‰å¿…è¦å±¬æ€§
   * - å°±åƒé–‹è¨­ä¸€å€‹æ–°çš„ã€Œå¾…è¾¦äº‹é …åˆ†é¡ã€
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * const newList = EntityFactory.createList({
   *   title: 'é€²è¡Œä¸­',
   *   position: 1
   * })
   * // çµæœæœƒå¾—åˆ°å®Œæ•´çš„åˆ—è¡¨ï¼Œcards é™£åˆ—æ˜¯ç©ºçš„ï¼Œç­‰å¾…ä¹‹å¾ŒåŠ å…¥å¡ç‰‡
   * 
   * ğŸ’¡ å·¥å» è‡ªå‹•åšçš„äº‹ï¼š
   * - ç”Ÿæˆå”¯ä¸€çš„ ID
   * - å»ºç«‹ç©ºçš„ cards é™£åˆ—ï¼ˆæ–°åˆ—è¡¨ä¸€é–‹å§‹æ²’æœ‰å¡ç‰‡ï¼‰
   * - è¨­å®šå»ºç«‹å’Œæ›´æ–°æ™‚é–“
   * - è™•ç†é è¨­ä½ç½®
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param params - å»ºç«‹åˆ—è¡¨éœ€è¦çš„è³‡è¨Š
   * @returns å®Œæ•´çš„åˆ—è¡¨ç‰©ä»¶
   */
  static createList(params: CreateListParams): List {
    return {
      id: this.generateId('list'),               // è‡ªå‹•ç”Ÿæˆå”¯ä¸€ IDï¼Œæ ¼å¼ï¼šlist_xxxxx_xxxxx
      title: params.title.trim(),                // æ¸…ç†æ¨™é¡Œçš„å‰å¾Œç©ºç™½
      position: params.position ?? 0,            // å¦‚æœæ²’æä¾›ä½ç½®ï¼Œå°±ç”¨ 0
      cards: [],                                 // æ–°åˆ—è¡¨ä¸€é–‹å§‹æ˜¯ç©ºçš„ï¼Œæ²’æœ‰ä»»ä½•å¡ç‰‡
      createdAt: new Date(),                     // è‡ªå‹•è¨­å®šå»ºç«‹æ™‚é–“ç‚ºç¾åœ¨
      updatedAt: new Date()                      // è‡ªå‹•è¨­å®šæ›´æ–°æ™‚é–“ç‚ºç¾åœ¨
    }
  }

  /**
   * ğŸ“‹ å»ºç«‹çœ‹æ¿ - çœ‹æ¿ç”Ÿç”¢ç·š
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - å»ºç«‹ä¸€å€‹æ–°çš„ç©ºçœ‹æ¿
   * - è‡ªå‹•è¨­å®šæ‰€æœ‰å¿…è¦å±¬æ€§
   * - å°±åƒå»ºç«‹ä¸€å€‹æ–°çš„ã€Œå°ˆæ¡ˆå·¥ä½œå€ã€
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * const newBoard = EntityFactory.createBoard({
   *   title: 'ç¶²ç«™é‡æ§‹å°ˆæ¡ˆ',
   *   description: 'ä½¿ç”¨ Vue 3 é‡æ§‹èˆŠç¶²ç«™'
   * })
   * // çµæœæœƒå¾—åˆ°å®Œæ•´çš„çœ‹æ¿ï¼Œlists é™£åˆ—æ˜¯ç©ºçš„ï¼Œç­‰å¾…ä¹‹å¾ŒåŠ å…¥åˆ—è¡¨
   * 
   * ğŸ’¡ å·¥å» è‡ªå‹•åšçš„äº‹ï¼š
   * - ç”Ÿæˆå”¯ä¸€çš„ ID
   * - å»ºç«‹ç©ºçš„ lists é™£åˆ—ï¼ˆæ–°çœ‹æ¿ä¸€é–‹å§‹æ²’æœ‰åˆ—è¡¨ï¼‰
   * - è¨­å®šå»ºç«‹å’Œæ›´æ–°æ™‚é–“
   * - è™•ç†å¯é¸çš„æè¿°
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param params - å»ºç«‹çœ‹æ¿éœ€è¦çš„è³‡è¨Š
   * @returns å®Œæ•´çš„çœ‹æ¿ç‰©ä»¶
   */
  static createBoard(params: CreateBoardParams): Board {
    return {
      id: this.generateId('board'),              // è‡ªå‹•ç”Ÿæˆå”¯ä¸€ IDï¼Œæ ¼å¼ï¼šboard_xxxxx_xxxxx
      title: params.title.trim(),                // æ¸…ç†æ¨™é¡Œçš„å‰å¾Œç©ºç™½
      description: params.description || '',     // å¦‚æœæ²’æä¾›æè¿°ï¼Œå°±ç”¨ç©ºå­—ä¸²
      lists: [],                                 // æ–°çœ‹æ¿ä¸€é–‹å§‹æ˜¯ç©ºçš„ï¼Œæ²’æœ‰ä»»ä½•åˆ—è¡¨
      createdAt: new Date(),                     // è‡ªå‹•è¨­å®šå»ºç«‹æ™‚é–“ç‚ºç¾åœ¨
      updatedAt: new Date()                      // è‡ªå‹•è¨­å®šæ›´æ–°æ™‚é–“ç‚ºç¾åœ¨
    }
  }

  /**
   * ğŸ”„ å¾ API è³‡æ–™å»ºç«‹å¡ç‰‡ - API æ ¼å¼è½‰æ›å™¨
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - æŠŠå¾ä¼ºæœå™¨æ‹¿åˆ°çš„è³‡æ–™è½‰æ›æˆæˆ‘å€‘ç¨‹å¼ä¸­ä½¿ç”¨çš„æ ¼å¼
   * - è™•ç†ä¸åŒçš„å‘½åè¦å‰‡ï¼ˆæ¯”å¦‚ API ç”¨ list_idï¼Œæˆ‘å€‘ç”¨ listIdï¼‰
   * - ç¢ºä¿è³‡æ–™æ ¼å¼ä¸€è‡´ï¼Œé¿å…ç¨‹å¼å‡ºéŒ¯
   * 
   * ğŸ’¡ ç‚ºä»€éº¼éœ€è¦è½‰æ›ï¼Ÿ
   * - API å¯èƒ½ç”¨è›‡å½¢å‘½åï¼ˆsnake_caseï¼‰ï¼šcreated_at, list_id
   * - æˆ‘å€‘ç¨‹å¼ç”¨é§å³°å‘½åï¼ˆcamelCaseï¼‰ï¼šcreatedAt, listId
   * - API çš„æ—¥æœŸæ˜¯å­—ä¸²ï¼Œæˆ‘å€‘éœ€è¦ Date ç‰©ä»¶
   * - API å¯èƒ½ç¼ºå°‘æŸäº›æ¬„ä½ï¼Œæˆ‘å€‘éœ€è¦è¨­é è¨­å€¼
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * // API å›å‚³çš„è³‡æ–™
   * const apiResponse = {
   *   id: 'card123',
   *   title: 'ä¿®å¾© bug',
   *   list_id: 'list456',
   *   created_at: '2024-01-01T10:00:00Z'
   * }
   * 
   * // è½‰æ›æˆæˆ‘å€‘çš„æ ¼å¼
   * const card = EntityFactory.createCardFromApi(apiResponse)
   * // ç¾åœ¨ card.listId å¯ä»¥ä½¿ç”¨ï¼Œcard.createdAt æ˜¯ Date ç‰©ä»¶
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param apiData - å¾ API æ”¶åˆ°çš„åŸå§‹è³‡æ–™
   * @returns è½‰æ›å¾Œçš„æ¨™æº–å¡ç‰‡ç‰©ä»¶
   */
  static createCardFromApi(apiData: any): Card {
    return {
      id: apiData.id,                                                    // ID ä¿æŒä¸è®Š
      title: apiData.title || '',                                        // æ¨™é¡Œï¼Œå¦‚æœæ˜¯ null å°±ç”¨ç©ºå­—ä¸²
      description: apiData.description || '',                            // æè¿°ï¼Œå¦‚æœæ˜¯ null å°±ç”¨ç©ºå­—ä¸²
      position: apiData.position || 0,                                   // ä½ç½®ï¼Œå¦‚æœæ˜¯ null å°±ç”¨ 0
      listId: apiData.list_id,                                          // ğŸ”„ è›‡å½¢è½‰é§å³°ï¼šlist_id â†’ listId
      createdAt: new Date(apiData.created_at),                          // ğŸ”„ å­—ä¸²è½‰ Dateï¼šcreated_at â†’ createdAt
      updatedAt: new Date(apiData.updated_at || apiData.created_at)     // ğŸ”„ å­—ä¸²è½‰ Dateï¼Œå¦‚æœæ²’æœ‰æ›´æ–°æ™‚é–“å°±ç”¨å»ºç«‹æ™‚é–“
    }
  }

  /**
   * ğŸ“‹ å¾ API è³‡æ–™å»ºç«‹åˆ—è¡¨ - API æ ¼å¼è½‰æ›å™¨
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - è½‰æ› API çš„åˆ—è¡¨è³‡æ–™æ ¼å¼
   * - åŒæ™‚è½‰æ›åˆ—è¡¨ä¸­åŒ…å«çš„æ‰€æœ‰å¡ç‰‡
   * - è™•ç†å·¢ç‹€è³‡æ–™çµæ§‹
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * // API å›å‚³çš„è³‡æ–™
   * const apiResponse = {
   *   id: 'list123',
   *   title: 'å¾…è¾¦äº‹é …',
   *   cards: [{ id: 'card1', title: 'ä»»å‹™1', list_id: 'list123' }],
   *   created_at: '2024-01-01T10:00:00Z'
   * }
   * 
   * const list = EntityFactory.createListFromApi(apiResponse)
   * // åˆ—è¡¨å’Œå…¶ä¸­çš„å¡ç‰‡éƒ½æœƒè¢«æ­£ç¢ºè½‰æ›
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param apiData - å¾ API æ”¶åˆ°çš„åŸå§‹åˆ—è¡¨è³‡æ–™
   * @returns è½‰æ›å¾Œçš„æ¨™æº–åˆ—è¡¨ç‰©ä»¶
   */
  static createListFromApi(apiData: any): List {
    return {
      id: apiData.id,                                                    // ID ä¿æŒä¸è®Š
      title: apiData.title || '',                                        // æ¨™é¡Œï¼Œå¦‚æœæ˜¯ null å°±ç”¨ç©ºå­—ä¸²
      position: apiData.position || 0,                                   // ä½ç½®ï¼Œå¦‚æœæ˜¯ null å°±ç”¨ 0
      cards: apiData.cards ? apiData.cards.map(this.createCardFromApi) : [], // ğŸ”„ è½‰æ›æ‰€æœ‰å¡ç‰‡ï¼Œå¦‚æœæ²’æœ‰å¡ç‰‡å°±ç”¨ç©ºé™£åˆ—
      createdAt: new Date(apiData.created_at),                          // ğŸ”„ å­—ä¸²è½‰ Date
      updatedAt: new Date(apiData.updated_at || apiData.created_at)     // ğŸ”„ å­—ä¸²è½‰ Date
    }
  }

  /**
   * ğŸ“„ è¤‡è£½å¡ç‰‡ - å¡ç‰‡å½±å°æ©Ÿ
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - å»ºç«‹ä¸€å¼µç¾æœ‰å¡ç‰‡çš„å‰¯æœ¬
   * - å¯ä»¥é¸æ“‡æ€§åœ°ä¿®æ”¹æŸäº›å±¬æ€§
   * - æ–°å¡ç‰‡æœƒæœ‰æ–°çš„ ID å’Œæ™‚é–“ï¼Œä½†å…§å®¹ä¾†è‡ªåŸå¡ç‰‡
   * 
   * ğŸ’¡ ç‚ºä»€éº¼éœ€è¦è¤‡è£½ï¼Ÿ
   * - å»ºç«‹ç¯„æœ¬å¡ç‰‡çš„å‰¯æœ¬
   * - ç§»å‹•å¡ç‰‡åˆ°ä¸åŒåˆ—è¡¨æ™‚
   * - å¿«é€Ÿå»ºç«‹ç›¸ä¼¼çš„å¡ç‰‡
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * const originalCard = { id: 'card1', title: 'åŸå§‹ä»»å‹™', listId: 'list1' }
   * 
   * // è¤‡è£½åˆ°ä¸åŒåˆ—è¡¨
   * const copiedCard = EntityFactory.cloneCard(originalCard, {
   *   listId: 'list2'
   * })
   * // çµæœï¼šæ–°å¡ç‰‡æœ‰æ–° IDï¼Œä½†æ¨™é¡Œç›¸åŒï¼Œåœ¨ä¸åŒåˆ—è¡¨ä¸­
   * 
   * // è¤‡è£½ä¸¦ä¿®æ”¹æ¨™é¡Œ
   * const modifiedCard = EntityFactory.cloneCard(originalCard, {
   *   title: 'ä¿®æ”¹å¾Œçš„ä»»å‹™'
   * })
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param card - è¦è¤‡è£½çš„åŸå§‹å¡ç‰‡
   * @param overrides - è¦è¦†è“‹çš„å±¬æ€§ï¼ˆå¯é¸ï¼‰
   * @returns æ–°çš„å¡ç‰‡å‰¯æœ¬
   */
  static cloneCard(card: Card, overrides: Partial<CreateCardParams> = {}): Card {
    return this.createCard({
      title: overrides.title || card.title,                    // ä½¿ç”¨æ–°æ¨™é¡Œï¼Œæˆ–ä¿æŒåŸæ¨™é¡Œ
      listId: overrides.listId || card.listId,                 // ä½¿ç”¨æ–°åˆ—è¡¨IDï¼Œæˆ–ä¿æŒåŸåˆ—è¡¨
      description: overrides.description || card.description,   // ä½¿ç”¨æ–°æè¿°ï¼Œæˆ–ä¿æŒåŸæè¿°
      position: overrides.position ?? card.position            // ä½¿ç”¨æ–°ä½ç½®ï¼Œæˆ–ä¿æŒåŸä½ç½®
    })
    // æ³¨æ„ï¼šé€™æœƒç”¢ç”Ÿæ–°çš„ IDã€createdAtã€updatedAt
  }

  /**
   * ğŸ“‹ è¤‡è£½åˆ—è¡¨ - åˆ—è¡¨å½±å°æ©Ÿ
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - å»ºç«‹ä¸€å€‹ç¾æœ‰åˆ—è¡¨çš„å®Œæ•´å‰¯æœ¬
   * - åŒ…æ‹¬åˆ—è¡¨ä¸­çš„æ‰€æœ‰å¡ç‰‡ä¹Ÿæœƒè¢«è¤‡è£½
   * - æ‰€æœ‰è¤‡è£½çš„å…§å®¹éƒ½æœƒæœ‰æ–°çš„ ID
   * 
   * ğŸ’¡ ç‚ºä»€éº¼éœ€è¦è¤‡è£½åˆ—è¡¨ï¼Ÿ
   * - å»ºç«‹å°ˆæ¡ˆç¯„æœ¬
   * - è¤‡è£½å·¥ä½œæµç¨‹åˆ°æ–°å°ˆæ¡ˆ
   * - å»ºç«‹å‚™ä»½æˆ–æ¸¬è©¦ç”¨çš„åˆ—è¡¨
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * const originalList = {
   *   id: 'list1',
   *   title: 'é–‹ç™¼æµç¨‹',
   *   cards: [
   *     { id: 'card1', title: 'åˆ†æéœ€æ±‚', listId: 'list1' },
   *     { id: 'card2', title: 'è¨­è¨ˆä»‹é¢', listId: 'list1' }
   *   ]
   * }
   * 
   * const copiedList = EntityFactory.cloneList(originalList)
   * // çµæœï¼š
   * // - æ–°åˆ—è¡¨æœ‰æ–° IDï¼Œæ¨™é¡Œæ˜¯ "é–‹ç™¼æµç¨‹ (å‰¯æœ¬)"
   * // - åŒ…å« 2 å¼µæ–°å¡ç‰‡ï¼Œéƒ½æœ‰æ–° IDï¼Œä½†å±¬æ–¼æ–°åˆ—è¡¨
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param list - è¦è¤‡è£½çš„åŸå§‹åˆ—è¡¨
   * @param overrides - è¦è¦†è“‹çš„å±¬æ€§ï¼ˆå¯é¸ï¼‰
   * @returns æ–°çš„åˆ—è¡¨å‰¯æœ¬ï¼ˆåŒ…å«æ‰€æœ‰å¡ç‰‡çš„å‰¯æœ¬ï¼‰
   */
  static cloneList(list: List, overrides: Partial<CreateListParams> = {}): List {
    // å…ˆå»ºç«‹æ–°åˆ—è¡¨
    const newList = this.createList({
      title: overrides.title || `${list.title} (å‰¯æœ¬)`,        // é è¨­åœ¨æ¨™é¡Œå¾ŒåŠ  "(å‰¯æœ¬)"
      position: overrides.position ?? list.position            // ä½¿ç”¨æ–°ä½ç½®ï¼Œæˆ–ä¿æŒåŸä½ç½®
    })
    
    // è¤‡è£½æ‰€æœ‰å¡ç‰‡ï¼Œä¸¦è®“å®ƒå€‘å±¬æ–¼æ–°åˆ—è¡¨
    newList.cards = list.cards.map(card => 
      this.cloneCard(card, { listId: newList.id })            // æ¯å¼µå¡ç‰‡éƒ½æŒ‡å‘æ–°åˆ—è¡¨çš„ ID
    )
    
    return newList
  }

  /**
   * ğŸ·ï¸ ç”Ÿæˆå”¯ä¸€ ID - ID è£½é€ æ©Ÿ
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - ç”Ÿæˆå…¨ä¸–ç•Œå”¯ä¸€çš„ ID
   * - çµ„åˆæ™‚é–“æˆ³è¨˜å’Œéš¨æ©Ÿæ•¸ï¼Œç¢ºä¿ä¸æœƒé‡è¤‡
   * - åŠ ä¸Šå‰ç¶´ï¼Œè®“äººä¸€çœ‹å°±çŸ¥é“æ˜¯ä»€éº¼é¡å‹çš„ ID
   * 
   * ğŸ’¡ ID çµ„æˆè¦å‰‡ï¼š
   * - å‰ç¶´ï¼šå‘Šè¨´æˆ‘å€‘é€™æ˜¯ä»€éº¼ï¼ˆcard, list, boardï¼‰
   * - æ™‚é–“æˆ³è¨˜ï¼šç¢ºä¿æ™‚é–“ä¸Šçš„å”¯ä¸€æ€§
   * - éš¨æ©Ÿæ•¸ï¼šé˜²æ­¢åŒä¸€æ¯«ç§’å…§ç”¢ç”Ÿé‡è¤‡ ID
   * 
   * ğŸ“ ç”Ÿæˆçš„ ID ç¯„ä¾‹ï¼š
   * - å¡ç‰‡ï¼šcard_1a2b3c4d_5e6f7g8h
   * - åˆ—è¡¨ï¼šlist_1a2b3c4d_9i0j1k2l
   * - çœ‹æ¿ï¼šboard_1a2b3c4d_3m4n5o6p
   * 
   * ğŸ”§ æŠ€è¡“ç´°ç¯€ï¼š
   * - toString(36) æŠŠæ•¸å­—è½‰æˆ 36 é€²ä½ï¼ˆåŒ…å« 0-9 å’Œ a-zï¼‰
   * - Date.now() å–å¾—ç¾åœ¨çš„æ¯«ç§’æ™‚é–“æˆ³è¨˜
   * - Math.random() ç”¢ç”Ÿ 0-1 ä¹‹é–“çš„éš¨æ©Ÿæ•¸
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param prefix - ID çš„å‰ç¶´ï¼ˆå¦‚ 'card', 'list', 'board'ï¼‰
   * @returns å”¯ä¸€çš„ ID å­—ä¸²
   */
  private static generateId(prefix: string): string {
    const timestamp = Date.now().toString(36)              // æ™‚é–“æˆ³è¨˜è½‰ 36 é€²ä½ï¼š1640995200000 â†’ 'abc123'
    const randomPart = Math.random().toString(36).substr(2, 8)  // éš¨æ©Ÿæ•¸è½‰ 36 é€²ä½ä¸¦å– 8 ä½ï¼š0.123456 â†’ 'def456gh'
    return `${prefix}_${timestamp}_${randomPart}`          // çµ„åˆçµæœï¼š'card_abc123_def456gh'
  }

  /**
   * âœ… é©—è­‰å¡ç‰‡ - å¡ç‰‡å“è³ªæª¢æŸ¥å“¡
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - æª¢æŸ¥å¡ç‰‡çš„è³‡æ–™æ˜¯å¦æ­£ç¢º
   * - æ‰¾å‡ºæ‰€æœ‰å•é¡Œä¸¦å›å ±
   * - ç¢ºä¿å¡ç‰‡ç¬¦åˆè¦æ ¼ï¼Œé¿å…ç¨‹å¼å‡ºéŒ¯
   * 
   * ğŸ’¡ ç‚ºä»€éº¼è¦é©—è­‰ï¼Ÿ
   * - é˜²æ­¢ä½¿ç”¨è€…è¼¸å…¥ç©ºç™½æ¨™é¡Œ
   * - ç¢ºä¿å¡ç‰‡æœ‰æ­¸å±¬çš„åˆ—è¡¨
   * - æª¢æŸ¥ä½ç½®æ˜¯åˆç†çš„æ•¸å­—
   * - åœ¨å­˜æª”å‰å°±ç™¼ç¾å•é¡Œï¼Œä¸è¦ç­‰åˆ°ç¨‹å¼ç•¶æ‰
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * const cardData = {
   *   title: '',           // âŒ ç©ºæ¨™é¡Œ
   *   listId: null,        // âŒ æ²’æœ‰åˆ—è¡¨
   *   position: -1         // âŒ è² æ•¸ä½ç½®
   * }
   * 
   * const errors = EntityFactory.validateCard(cardData)
   * console.log(errors)
   * // è¼¸å‡ºï¼š['å¡ç‰‡æ¨™é¡Œä¸èƒ½ç‚ºç©º', 'å¡ç‰‡å¿…é ˆå±¬æ–¼ä¸€å€‹åˆ—è¡¨', 'å¡ç‰‡ä½ç½®å¿…é ˆæ˜¯éè² æ•¸']
   * 
   * if (errors.length === 0) {
   *   // è³‡æ–™æ­£ç¢ºï¼Œå¯ä»¥å»ºç«‹å¡ç‰‡
   * } else {
   *   // æœ‰å•é¡Œï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯çµ¦ä½¿ç”¨è€…
   * }
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param card - è¦é©—è­‰çš„å¡ç‰‡è³‡æ–™ï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰
   * @returns éŒ¯èª¤è¨Šæ¯é™£åˆ—ï¼Œç©ºé™£åˆ—è¡¨ç¤ºæ²’æœ‰éŒ¯èª¤
   */
  static validateCard(card: Partial<Card>): string[] {
    const errors: string[] = []                             // æ”¶é›†æ‰€æœ‰éŒ¯èª¤çš„é™£åˆ—
    
    // æª¢æŸ¥æ¨™é¡Œæ˜¯å¦ç‚ºç©º
    if (!card.title?.trim()) {                              // ?. æ˜¯å®‰å…¨å°èˆªï¼Œé¿å… null.trim() å‡ºéŒ¯
      errors.push('å¡ç‰‡æ¨™é¡Œä¸èƒ½ç‚ºç©º')
    }
    
    // æª¢æŸ¥æ˜¯å¦æœ‰æŒ‡å®šåˆ—è¡¨
    if (!card.listId) {
      errors.push('å¡ç‰‡å¿…é ˆå±¬æ–¼ä¸€å€‹åˆ—è¡¨')
    }
    
    // æª¢æŸ¥ä½ç½®æ˜¯å¦ç‚ºæœ‰æ•ˆæ•¸å­—
    if (typeof card.position !== 'number' || card.position < 0) {
      errors.push('å¡ç‰‡ä½ç½®å¿…é ˆæ˜¯éè² æ•¸')
    }
    
    return errors                                            // å›å‚³æ‰€æœ‰ç™¼ç¾çš„å•é¡Œ
  }

  /**
   * âœ… é©—è­‰åˆ—è¡¨ - åˆ—è¡¨å“è³ªæª¢æŸ¥å“¡
   * 
   * ğŸ¤” é€™å€‹å‡½æ•¸åšä»€éº¼ï¼Ÿ
   * - æª¢æŸ¥åˆ—è¡¨çš„è³‡æ–™æ˜¯å¦æ­£ç¢º
   * - ç¢ºä¿åˆ—è¡¨ç¬¦åˆè¦æ ¼
   * - åœ¨å»ºç«‹æˆ–æ›´æ–°å‰é©—è­‰è³‡æ–™
   * 
   * ğŸ“ ä½¿ç”¨ä¾‹å­ï¼š
   * const listData = {
   *   title: '   ',        // âŒ åªæœ‰ç©ºç™½çš„æ¨™é¡Œ
   *   position: 'abc'      // âŒ ä½ç½®ä¸æ˜¯æ•¸å­—
   * }
   * 
   * const errors = EntityFactory.validateList(listData)
   * // è¼¸å‡ºï¼š['åˆ—è¡¨æ¨™é¡Œä¸èƒ½ç‚ºç©º', 'åˆ—è¡¨ä½ç½®å¿…é ˆæ˜¯éè² æ•¸']
   * 
   * ğŸ”§ åƒæ•¸èªªæ˜ï¼š
   * @param list - è¦é©—è­‰çš„åˆ—è¡¨è³‡æ–™ï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰
   * @returns éŒ¯èª¤è¨Šæ¯é™£åˆ—ï¼Œç©ºé™£åˆ—è¡¨ç¤ºæ²’æœ‰éŒ¯èª¤
   */
  static validateList(list: Partial<List>): string[] {
    const errors: string[] = []                             // æ”¶é›†æ‰€æœ‰éŒ¯èª¤çš„é™£åˆ—
    
    // æª¢æŸ¥æ¨™é¡Œæ˜¯å¦ç‚ºç©ºï¼ˆåŒ…æ‹¬åªæœ‰ç©ºç™½çš„æƒ…æ³ï¼‰
    if (!list.title?.trim()) {
      errors.push('åˆ—è¡¨æ¨™é¡Œä¸èƒ½ç‚ºç©º')
    }
    
    // æª¢æŸ¥ä½ç½®æ˜¯å¦ç‚ºæœ‰æ•ˆæ•¸å­—
    if (typeof list.position !== 'number' || list.position < 0) {
      errors.push('åˆ—è¡¨ä½ç½®å¿…é ˆæ˜¯éè² æ•¸')
    }
    
    return errors                                            // å›å‚³æ‰€æœ‰ç™¼ç¾çš„å•é¡Œ
  }
}