<!--
  ğŸ“‹ ListMenu çµ„ä»¶ - åˆ—è¡¨æ“ä½œé¸å–®çµ„ä»¶ (ä¸‰é»é¸å–®)
  
  ğŸ¯ çµ„ä»¶ä¸»è¦åŠŸèƒ½ï¼š
  âœ… é¡¯ç¤ºåˆ—è¡¨æ“ä½œçš„ä¸‰é»é¸å–®æŒ‰éˆ• (â‹® åœ–ç¤º)
  âœ… ç®¡ç†é¸å–®çš„é–‹å•Ÿ/é—œé–‰ç‹€æ…‹ (é»æ“ŠæŒ‰éˆ•åˆ‡æ›ï¼Œé»æ“Šå¤–éƒ¨é—œé–‰)
  âœ… æä¾›åˆ—è¡¨æ“ä½œé¸é …ï¼šæ–°å¢å¡ç‰‡ã€åˆªé™¤åˆ—è¡¨
  âœ… è™•ç†é»æ“Šå¤–éƒ¨å€åŸŸè‡ªå‹•é—œé–‰é¸å–®çš„åŠŸèƒ½
  âœ… æ”¯æ´å…¨åŸŸé¸å–®ç‹€æ…‹ç®¡ç† (åŒæ™‚åªèƒ½é–‹å•Ÿä¸€å€‹é¸å–®)
  âœ… é˜²æ­¢é»æ“Šäº‹ä»¶å†’æ³¡ï¼Œé¿å…æ„å¤–é—œé–‰é¸å–®
  
  ğŸ”§ ä½¿ç”¨çš„æŠ€è¡“æ£§ï¼š
  - Vue 3 Composition API
  - è‡ªè¨‚ useListMenu composable (é¸å–®ç‹€æ…‹ç®¡ç†æŠ½è±¡å±¤)
  - TypeScript å‹åˆ¥å®‰å…¨
  - Tailwind CSS æ¨£å¼
  - å…¨åŸŸäº‹ä»¶ç›£è½ (document click)
  
  ğŸ“¦ Props åƒæ•¸ï¼š
  - listId: string - æ¨™è­˜æ­¤é¸å–®å±¬æ–¼å“ªå€‹åˆ—è¡¨ï¼Œç”¨æ–¼å…¨åŸŸé¸å–®ç‹€æ…‹ç®¡ç†
  
  ğŸš€ Emit äº‹ä»¶ï¼š
  - add-card: ç•¶é»æ“Šã€Œæ–°å¢å¡ç‰‡ã€æ™‚è§¸ç™¼ï¼Œé€šçŸ¥çˆ¶çµ„ä»¶åŸ·è¡Œæ–°å¢å¡ç‰‡æ“ä½œ
  - delete-list: ç•¶é»æ“Šã€Œåˆªé™¤åˆ—è¡¨ã€æ™‚è§¸ç™¼ï¼Œé€šçŸ¥çˆ¶çµ„ä»¶åŸ·è¡Œåˆªé™¤åˆ—è¡¨æ“ä½œ
  
  ğŸ’¡ æ ¸å¿ƒäº¤äº’é‚è¼¯ï¼š
  1. é¸å–®é–‹é—œï¼šé»æ“Šä¸‰é»æŒ‰éˆ• â†’ åˆ‡æ›é¸å–®é¡¯ç¤ºç‹€æ…‹ (é–‹å•Ÿ/é—œé–‰)
  2. å…¨åŸŸç®¡ç†ï¼šé–‹å•Ÿæ–°é¸å–®æ™‚è‡ªå‹•é—œé–‰å…¶ä»–å·²é–‹å•Ÿçš„é¸å–® (é€é useListMenu)
  3. å¤–éƒ¨é»æ“Šé—œé–‰ï¼šé»æ“Šé¸å–®å®¹å™¨å¤–çš„ä»»ä½•ä½ç½® â†’ è‡ªå‹•é—œé–‰æ‰€æœ‰é¸å–®
  4. æ“ä½œåŸ·è¡Œï¼šé»æ“Šé¸å–®é …ç›® â†’ emit äº‹ä»¶çµ¦çˆ¶çµ„ä»¶ â†’ è‡ªå‹•é—œé–‰é¸å–®
  5. äº‹ä»¶éš”é›¢ï¼šä½¿ç”¨ event.stopPropagation() é˜²æ­¢é¸å–®å…§é»æ“Šè§¸ç™¼å¤–éƒ¨é—œé–‰é‚è¼¯
  
  ğŸ¯ é¸å–®ç‹€æ…‹ç®¡ç†èªªæ˜ï¼š
  - ä½¿ç”¨ useListMenu composable ç®¡ç†å…¨åŸŸé¸å–®ç‹€æ…‹
  - openMenuId å­˜æ”¾ç•¶å‰é–‹å•Ÿé¸å–®çš„ listIdï¼Œnull è¡¨ç¤ºæ‰€æœ‰é¸å–®éƒ½é—œé–‰
  - æ¯å€‹ ListMenu å¯¦ä¾‹é€šé computed åˆ¤æ–·è‡ªå·±æ˜¯å¦æ‡‰è©²é¡¯ç¤º
  - ç¢ºä¿åŒæ™‚åªæœ‰ä¸€å€‹é¸å–®é–‹å•Ÿï¼Œæå‡ç”¨æˆ¶é«”é©—
  
  ğŸ”§ äº‹ä»¶è™•ç†æ©Ÿåˆ¶ï¼š
  - handleToggleMenu: è™•ç†ä¸‰é»æŒ‰éˆ•é»æ“Šï¼Œåˆ‡æ›é¸å–®ç‹€æ…‹ï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
  - handleAddCard: è™•ç†æ–°å¢å¡ç‰‡é»æ“Šï¼Œç™¼é€äº‹ä»¶å¾Œé—œé–‰é¸å–®ï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
  - handleDeleteList: è™•ç†åˆªé™¤åˆ—è¡¨é»æ“Šï¼Œç™¼é€äº‹ä»¶å¾Œé—œé–‰é¸å–®ï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
  - handleClickOutside: ç›£è½ document é»æ“Šï¼Œæª¢æ¸¬æ˜¯å¦é»æ“Šé¸å–®å¤–éƒ¨ï¼Œè‡ªå‹•é—œé–‰é¸å–®
  
  ğŸ¯ SOLID åŸå‰‡è¨­è¨ˆèªªæ˜ï¼š
  
  âœ… S (Single Responsibility) - å–®ä¸€è·è²¬åŸå‰‡
     åªè² è²¬é¸å–®çš„ã€Œé¡¯ç¤º/éš±è—ã€å’Œã€Œé»æ“Šäº‹ä»¶è™•ç†ã€
     ä¸è™•ç†å…·é«”çš„æ¥­å‹™é‚è¼¯ï¼ˆå¦‚å¯¦éš›åˆªé™¤åˆ—è¡¨æˆ–æ–°å¢å¡ç‰‡ï¼‰
     é¸å–®ç‹€æ…‹ç®¡ç†ã€äº‹ä»¶è™•ç†ã€UI æ¸²æŸ“å„è‡ªç¨ç«‹
     
  âœ… O (Open/Closed) - é–‹æ”¾å°é–‰åŸå‰‡
     è¦æ–°å¢é¸å–®é …ç›®æ™‚ï¼Œåªéœ€è¦åŠ æ–°çš„ <button> å’Œå°æ‡‰çš„ emit
     ä¸éœ€è¦ä¿®æ”¹ç¾æœ‰çš„é¸å–®é‚è¼¯æˆ–ç‹€æ…‹ç®¡ç†
     å°æ“´å±•é–‹æ”¾ï¼Œå°ä¿®æ”¹å°é–‰
     
  âœ… L (Liskov Substitution) - é‡Œæ°æ›¿æ›åŸå‰‡
     ä»»ä½•æ¥å— listId çš„çµ„ä»¶éƒ½å¯ä»¥ä½¿ç”¨æ­¤é¸å–®çµ„ä»¶
     ä¸æœƒå› ç‚ºä¸åŒçš„ listId æ ¼å¼è€Œå°è‡´åŠŸèƒ½ç•°å¸¸
     
  âœ… I (Interface Segregation) - ä»‹é¢éš”é›¢åŸå‰‡
     åªè¦æ±‚çˆ¶çµ„ä»¶æä¾› listIdï¼Œåª emit å¿…è¦çš„äº‹ä»¶
     ä¸å¼·è¿«çˆ¶çµ„ä»¶å¯¦ä½œä¸éœ€è¦çš„åŠŸèƒ½
     
  âœ… D (Dependency Inversion) - ä¾è³´åè½‰åŸå‰‡  
     ä¸ç›´æ¥ä¾è³´ boardStoreï¼Œè€Œæ˜¯é€é useListMenu æŠ½è±¡å±¤
     çµ„ä»¶ä¾è³´æŠ½è±¡ä»‹é¢ï¼Œä¸ä¾è³´å…·é«”ç‹€æ…‹ç®¡ç†å¯¦ä½œ
     
  ğŸ“ æ“´å±•æ–¹å¼ç¯„ä¾‹ï¼š
     æƒ³è¦æ–°å¢ã€Œè¤‡è£½åˆ—è¡¨ã€åŠŸèƒ½ï¼Ÿ
     1. åœ¨æ¨¡æ¿ä¸­åŠ ä¸€å€‹ <button @click="handleCopyList">è¤‡è£½åˆ—è¡¨</button>
     2. åœ¨ script ä¸­åŠ ä¸€å€‹ handleCopyList å‡½æ•¸ï¼Œemit('copy-list') ä¸¦ closeAllMenus()
     3. åœ¨çˆ¶çµ„ä»¶ ListItem ä¸­æ¥æ”¶ @copy-list äº‹ä»¶
     4. å®Œå…¨ä¸æœƒå½±éŸ¿ç¾æœ‰çš„ã€Œæ–°å¢å¡ç‰‡ã€å’Œã€Œåˆªé™¤åˆ—è¡¨ã€åŠŸèƒ½
     
     æƒ³è¦æ–°å¢ã€Œç§»å‹•åˆ—è¡¨ã€åŠŸèƒ½ï¼Ÿ
     1. åŠ  <button @click="handleMoveList">ç§»å‹•åˆ—è¡¨</button>
     2. åŠ  handleMoveList å‡½æ•¸è™•ç†
     3. çˆ¶çµ„ä»¶æ¥æ”¶äº‹ä»¶ä¸¦è™•ç†æ¥­å‹™é‚è¼¯
  
  ğŸ§ª æ¸¬è©¦è¦†è“‹ï¼š
     çµ„ä»¶åŠŸèƒ½å·²åŒ…å«åœ¨æ•´é«”æ¸¬è©¦ä¸­ï¼Œç‰¹åˆ¥æ˜¯é»æ“Šå¤–éƒ¨é—œé–‰çš„é‚è¼¯
     ä¿®å¾©äº†ä¹‹å‰çš„é›™é»æ“Šå•é¡Œï¼ˆäº‹ä»¶å†’æ³¡å°è‡´é¸å–®ç«‹å³é—œé–‰ï¼‰
  
  ğŸ› å·²ä¿®å¾©çš„å•é¡Œï¼š
     - é›™é»æ“Šå•é¡Œï¼šä¹‹å‰é»æ“Šé¸å–®æŒ‰éˆ•éœ€è¦é»å…©æ¬¡æ‰èƒ½é–‹å•Ÿ
     - åŸå› ï¼šé»æ“Šäº‹ä»¶å†’æ³¡åˆ° documentï¼Œç«‹å³è§¸ç™¼ handleClickOutside é—œé–‰é¸å–®
     - è§£æ±ºï¼šåœ¨æ‰€æœ‰é»æ“Šè™•ç†å‡½æ•¸ä¸­åŠ å…¥ event.stopPropagation()
  
  ğŸ“Š æ•ˆèƒ½è€ƒé‡ï¼š
     - ä½¿ç”¨äº‹ä»¶å§”è¨—ï¼Œæ‰€æœ‰ ListMenu å…±äº«ä¸€å€‹ document click ç›£è½å™¨
     - ä½¿ç”¨ computed å±¬æ€§æœ€ä½³åŒ–é¸å–®é¡¯ç¤ºåˆ¤æ–·
     - onMounted/onUnmounted ç¢ºä¿äº‹ä»¶ç›£è½å™¨æ­£ç¢ºæ¸…ç†ï¼Œé¿å…è¨˜æ†¶é«”æ´©æ¼
  
  ğŸ”„ ç”Ÿå‘½é€±æœŸç®¡ç†ï¼š
     - onMounted: åŠ å…¥ document click äº‹ä»¶ç›£è½å™¨
     - onUnmounted: ç§»é™¤ document click äº‹ä»¶ç›£è½å™¨ï¼Œé˜²æ­¢è¨˜æ†¶é«”æ´©æ¼
     - æ¯å€‹çµ„ä»¶å¯¦ä¾‹ç¨ç«‹ç®¡ç†è‡ªå·±çš„ç”Ÿå‘½é€±æœŸ
-->

<template>
  <!-- ä¸‰é»é¸å–®æŒ‰éˆ•å®¹å™¨ -->
  <div class="relative list-menu-container">
    <!-- ä¸‰é»é¸å–®æŒ‰éˆ• -->
    <button 
      @click="handleToggleMenu"
      class="p-1 rounded hover:bg-gray-300 transition-colors duration-200"
    >
      <svg 
        class="w-4 h-4 text-gray-600" 
        fill="currentColor" 
        viewBox="0 0 20 20"
      >
        <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
      </svg>
    </button>
    
    <!-- ä¸‹æ‹‰é¸å–® -->
    <div 
      v-if="isMenuOpen"
      class="absolute right-0 top-8 bg-white rounded-lg shadow-lg border border-gray-200 py-2 w-40 z-10"
    >
      <button 
        @click="handleAddCard"
        class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200"
      >
        æ–°å¢å¡ç‰‡
      </button>
      <button 
        @click="handleDeleteList"
        class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200"
      >
        åˆªé™¤åˆ—è¡¨
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed, onMounted, onUnmounted } from 'vue'
import { useListMenu } from '@/composables/useListMenu'

// çµ„ä»¶ propsï¼ˆç”¨æ–¼æ¨™è­˜é¸å–®æ‰€å±¬çš„åˆ—è¡¨ï¼‰
const props = defineProps<{
  listId: string
}>()

// çµ„ä»¶ emit äº‹ä»¶
const emit = defineEmits<{
  'add-card': []
  'delete-list': []
}>()

// ä½¿ç”¨é¸å–®ç®¡ç† composableï¼ˆä¾è³´åè½‰åŸå‰‡ï¼‰
// çµ„ä»¶ä¸ç›´æ¥ä¾è³´ boardStoreï¼Œè€Œæ˜¯é€éæŠ½è±¡å±¤ useListMenu
const { openMenuId, toggleMenu, closeAllMenus } = useListMenu()

// è¨ˆç®—ç•¶å‰é¸å–®æ˜¯å¦é–‹å•Ÿï¼ˆåŸºæ–¼ composable æä¾›çš„éŸ¿æ‡‰å¼ç‹€æ…‹ï¼‰
// åªæœ‰ç•¶å…¨åŸŸé–‹å•Ÿçš„é¸å–® ID ç­‰æ–¼ç•¶å‰åˆ—è¡¨ ID æ™‚ï¼Œæ­¤é¸å–®æ‰æ˜¯é–‹å•Ÿç‹€æ…‹
const isMenuOpen = computed<boolean>(() => openMenuId.value === props.listId)

// åˆ‡æ›é¸å–®é¡¯ç¤ºç‹€æ…‹
// é€é composable çµ±ä¸€ç®¡ç†ï¼Œç¢ºä¿åŒæ™‚åªæœ‰ä¸€å€‹é¸å–®é–‹å•Ÿ
const handleToggleMenu = (event: Event) => {
  // é˜²æ­¢é»æ“Šäº‹ä»¶å†’æ³¡åˆ° documentï¼Œé¿å…ç«‹å³è§¸ç™¼ handleClickOutside
  event.stopPropagation()
  toggleMenu(props.listId)
}

// è™•ç†æ–°å¢å¡ç‰‡
const handleAddCard = (event: Event) => {
  // é˜²æ­¢äº‹ä»¶å†’æ³¡
  event.stopPropagation()
  emit('add-card')
  // åŸ·è¡Œå‹•ä½œå¾Œé—œé–‰é¸å–®
  closeAllMenus()
}

// è™•ç†åˆªé™¤åˆ—è¡¨
const handleDeleteList = (event: Event) => {
  // é˜²æ­¢äº‹ä»¶å†’æ³¡
  event.stopPropagation()
  emit('delete-list')
  // åŸ·è¡Œå‹•ä½œå¾Œé—œé–‰é¸å–®
  closeAllMenus()
}

// é»æ“Šå¤–éƒ¨å€åŸŸé—œé–‰æ‰€æœ‰é¸å–®
const handleClickOutside = (event: Event) => {
  const target = event.target as HTMLElement
  if (!target.closest('.list-menu-container')) {
    closeAllMenus()
  }
}

// çµ„ä»¶æ›è¼‰æ™‚åŠ å…¥äº‹ä»¶ç›£è½å™¨
onMounted(() => {
  document.addEventListener('click', handleClickOutside)
})

// çµ„ä»¶å¸è¼‰æ™‚ç§»é™¤äº‹ä»¶ç›£è½å™¨
onUnmounted(() => {
  document.removeEventListener('click', handleClickOutside)
})
</script>