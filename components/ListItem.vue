<!--
  ğŸ“‹ ListItem çµ„ä»¶ - çœ‹æ¿åˆ—è¡¨çµ„ä»¶ (Trello Clone æ ¸å¿ƒçµ„ä»¶ä¹‹ä¸€)
  
  ğŸ¯ çµ„ä»¶ä¸»è¦åŠŸèƒ½ï¼š
  âœ… æ¸²æŸ“å–®ä¸€çœ‹æ¿åˆ—è¡¨åŠå…¶æ‰€æœ‰å¡ç‰‡
  âœ… æ”¯æ´åˆ—è¡¨æ¨™é¡Œçš„å³æ™‚ç·¨è¼¯åŠŸèƒ½ (é»æ“Šæ¨™é¡Œå¯ç·¨è¼¯ï¼ŒæŒ‰ Enter å„²å­˜ï¼ŒæŒ‰ Esc å–æ¶ˆ)
  âœ… ç®¡ç†å¡ç‰‡çš„æ‹–æ‹½æ’åºåŠŸèƒ½ (åŒåˆ—è¡¨å…§ç§»å‹• + è·¨åˆ—è¡¨ç§»å‹•)
  âœ… æä¾›åˆ—è¡¨æ“ä½œé¸å–® (æ–°å¢å¡ç‰‡ã€åˆªé™¤åˆ—è¡¨)
  âœ… è™•ç†å¡ç‰‡çš„æ–°å¢å’Œé–‹å•Ÿç·¨è¼¯åŠŸèƒ½
  âœ… æ•´åˆäº‹ä»¶é€šè¨Šç³»çµ±ï¼Œå°‡æ“ä½œå‚³éçµ¦çˆ¶çµ„ä»¶
  
  ğŸ”§ ä½¿ç”¨çš„æŠ€è¡“æ£§ï¼š
  - Vue 3 Composition API
  - VueDraggableNext (æ‹–æ‹½åŠŸèƒ½)
  - è‡ªè¨‚ useListActions composable (æ¥­å‹™é‚è¼¯æŠ½è±¡å±¤)
  - TypeScript å‹åˆ¥å®‰å…¨
  - Tailwind CSS æ¨£å¼
  
  ğŸ“¦ Props åƒæ•¸ï¼š
  - list: ListUI - åˆ—è¡¨è³‡æ–™ç‰©ä»¶ï¼ŒåŒ…å« idã€titleã€positionã€cards ç­‰æ¬„ä½
  
  ğŸš€ Emit äº‹ä»¶ï¼š
  - card-move: ç•¶å¡ç‰‡è¢«æ‹–æ‹½ç§»å‹•æ™‚è§¸ç™¼ï¼Œå‚³éæ‹–æ‹½äº‹ä»¶è³‡æ–™çµ¦çˆ¶çµ„ä»¶è™•ç†
  - open-card-modal: ç•¶é»æ“Šå¡ç‰‡è¦é–‹å•Ÿç·¨è¼¯æ¨¡æ…‹æ¡†æ™‚è§¸ç™¼ï¼Œå‚³éå¡ç‰‡è³‡æ–™çµ¦çˆ¶çµ„ä»¶
  
  ğŸ—ï¸ å­çµ„ä»¶çµæ§‹ï¼š
  - Card.vue: æ¸²æŸ“å–®ä¸€å¡ç‰‡ï¼Œè™•ç†å¡ç‰‡é¡¯ç¤ºå’Œé»æ“Šäº‹ä»¶
  - ListMenu.vue: æ¸²æŸ“ä¸‰é»é¸å–®ï¼Œæä¾›åˆ—è¡¨æ“ä½œåŠŸèƒ½ (æ–°å¢å¡ç‰‡ã€åˆªé™¤åˆ—è¡¨)
  
  ğŸ’¡ æ ¸å¿ƒäº¤äº’é‚è¼¯ï¼š
  1. åˆ—è¡¨æ¨™é¡Œç·¨è¼¯ï¼šé»æ“Šæ¨™é¡Œ â†’ è®Šæˆè¼¸å…¥æ¡† â†’ Enter å„²å­˜ / Esc å–æ¶ˆ / å¤±ç„¦å„²å­˜
  2. å¡ç‰‡æ‹–æ‹½ç§»å‹•ï¼šä½¿ç”¨ VueDraggableNextï¼Œæ”¯æ´åŒåˆ—è¡¨æ’åºå’Œè·¨åˆ—è¡¨ç§»å‹•
  3. æ–°å¢å¡ç‰‡ï¼šé»æ“Šåº•éƒ¨æŒ‰éˆ•æˆ–é¸å–®é …ç›® â†’ å‘¼å« useListActions.addCard()
  4. åˆªé™¤åˆ—è¡¨ï¼šé€šéé¸å–® â†’ å‘¼å« useListActions.deleteList()
  5. é–‹å•Ÿå¡ç‰‡ç·¨è¼¯ï¼šé»æ“Šå¡ç‰‡ â†’ emit äº‹ä»¶çµ¦çˆ¶çµ„ä»¶é–‹å•Ÿæ¨¡æ…‹æ¡†
  
  ğŸ¯ SOLID åŸå‰‡è¨­è¨ˆèªªæ˜ï¼š
  
  âœ… S (Single Responsibility) - å–®ä¸€è·è²¬åŸå‰‡
     åªè² è²¬ã€Œå–®å€‹åˆ—è¡¨ã€çš„æ¸²æŸ“å’ŒåŸºæœ¬äº’å‹•ï¼Œä¸è™•ç†æ•´é«”çœ‹æ¿é‚è¼¯
     æ¨™é¡Œç·¨è¼¯ã€å¡ç‰‡ç®¡ç†ã€é¸å–®æ“ä½œå„è‡ªç¨ç«‹ï¼Œè·è²¬æ¸…æ™°åˆ†é›¢
     
  âœ… O (Open/Closed) - é–‹æ”¾å°é–‰åŸå‰‡
     è¦æ–°å¢åˆ—è¡¨åŠŸèƒ½æ™‚ï¼Œé€é emit äº‹ä»¶å’Œ useListActions æ“´å±•
     ä¸éœ€è¦ä¿®æ”¹æ­¤çµ„ä»¶çš„æ ¸å¿ƒé‚è¼¯ï¼Œç¬¦åˆå°æ“´å±•é–‹æ”¾ã€å°ä¿®æ”¹å°é–‰
     
  âœ… L (Liskov Substitution) - é‡Œæ°æ›¿æ›åŸå‰‡
     çµ„ä»¶æ¥å— ListUI å‹åˆ¥ï¼Œä»»ä½•ç¬¦åˆæ­¤ä»‹é¢çš„åˆ—è¡¨ç‰©ä»¶éƒ½å¯ä»¥æ­£å¸¸é‹ä½œ
     ä¸æœƒå› ç‚ºåˆ—è¡¨è³‡æ–™çš„ç´°å¾®å·®ç•°è€Œå°è‡´çµ„ä»¶åŠŸèƒ½ç•°å¸¸
     
  âœ… I (Interface Segregation) - ä»‹é¢éš”é›¢åŸå‰‡
     åªä¾è³´æ‰€éœ€çš„ props å’Œ emit äº‹ä»¶ï¼Œä¸å¼·è¿«ä½¿ç”¨è€…å¯¦ä½œä¸éœ€è¦çš„ä»‹é¢
     useListActions åªæš´éœ²æ­¤çµ„ä»¶å¯¦éš›éœ€è¦çš„æ–¹æ³•
     
  âœ… D (Dependency Inversion) - ä¾è³´åè½‰åŸå‰‡  
     ä¸ç›´æ¥ä¾è³´ boardStoreï¼Œè€Œæ˜¯é€é useListActions æŠ½è±¡å±¤
     çµ„ä»¶ä¾è³´æŠ½è±¡ä»‹é¢ï¼Œä¸ä¾è³´å…·é«”å¯¦ä½œï¼Œæå‡å¯æ¸¬è©¦æ€§å’Œç¶­è­·æ€§
     
  ğŸ“ æ“´å±•æ–¹å¼ï¼š
     - æ–°å¢åˆ—è¡¨æ“ä½œï¼šåœ¨ useListActions åŠ å‡½æ•¸ï¼Œæ­¤çµ„ä»¶è‡ªå‹•å¯ç”¨
     - æ–°å¢ UI å…ƒç´ ï¼šåœ¨ ListMenu çµ„ä»¶åŠ æŒ‰éˆ•ï¼Œæ­¤çµ„ä»¶æ¥æ”¶ emit äº‹ä»¶
     - æ–°å¢å¡ç‰‡åŠŸèƒ½ï¼šä¿®æ”¹ Card çµ„ä»¶ï¼Œæ­¤çµ„ä»¶è‡ªå‹•ç¹¼æ‰¿æ–°åŠŸèƒ½
     - ä¿®æ”¹æ‹–æ‹½è¡Œç‚ºï¼šèª¿æ•´ draggable çµ„ä»¶çš„è¨­å®šï¼Œä¸å½±éŸ¿å…¶ä»–é‚è¼¯
  
  ğŸ§ª æ¸¬è©¦è¦†è“‹ï¼š
     çµ„ä»¶å·²æœ‰å®Œæ•´çš„å–®å…ƒæ¸¬è©¦è¦†è“‹ï¼ŒåŒ…å«æ‹–æ‹½åŠŸèƒ½ã€äº‹ä»¶è™•ç†ã€ç·¨è¼¯åŠŸèƒ½ç­‰
     æ¸¬è©¦æ–‡ä»¶ï¼štests/unit/components/CardDragDrop.test.ts (åŒ…å« ListItem æ¸¬è©¦)
  
  ğŸ“Š æ•ˆèƒ½è€ƒé‡ï¼š
     - ä½¿ç”¨ Vue 3 éŸ¿æ‡‰å¼ç³»çµ±ï¼Œåªåœ¨å¿…è¦æ™‚é‡æ–°æ¸²æŸ“
     - æ‹–æ‹½åŠŸèƒ½ä½¿ç”¨è™›æ“¬ DOM æœ€ä½³åŒ–ï¼Œæ”¯æ´å¤§é‡å¡ç‰‡çš„é †æš¢ç§»å‹•
     - äº‹ä»¶è™•ç†ä½¿ç”¨ event.stopPropagation() é¿å…ä¸å¿…è¦çš„äº‹ä»¶å†’æ³¡
  
  ğŸ”„ ç‹€æ…‹ç®¡ç†ï¼š
     - æœ¬åœ°ç‹€æ…‹ï¼šåˆ—è¡¨æ¨™é¡Œç·¨è¼¯ç‹€æ…‹ (isEditingTitle, editingTitle)
     - å…¨åŸŸç‹€æ…‹ï¼šé€é useListActions èˆ‡ boardStore äº’å‹•
     - éŸ¿æ‡‰å¼æ›´æ–°ï¼šç•¶ boardStore è³‡æ–™è®Šæ›´æ™‚ï¼Œçµ„ä»¶è‡ªå‹•é‡æ–°æ¸²æŸ“
-->

<template>
  <!-- å–®å€‹åˆ—è¡¨å®¹å™¨ -->
  <div class="bg-gray-200 rounded w-80 p-2 flex-shrink-0" :data-list-id="list.id">
    <!-- åˆ—è¡¨æ¨™é¡Œå€åŸŸ -->
    <div class="cursor-pointer flex justify-between items-center p-2 mb-2 relative">
      <!-- éç·¨è¼¯ç‹€æ…‹ï¼šé¡¯ç¤ºæ¨™é¡Œ -->
      <h2 
        v-if="!isEditingTitle" 
        class="w-full text-base font-bold select-none cursor-pointer hover:bg-gray-100 px-2 py-1 rounded"
        @click="startEditTitle"
      >
        {{ list.title }}
      </h2>
      
      <!-- ç·¨è¼¯ç‹€æ…‹ï¼šé¡¯ç¤ºè¼¸å…¥æ¡† -->
      <input
        v-else
        ref="titleInput"
        v-model="editingTitle"
        class="w-full text-base font-bold bg-white border-2 border-blue-400 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all"
        @keydown.enter="saveTitle"
        @blur="saveTitle"
        @keydown.esc="cancelEdit"
      />
      
      <!-- åˆ—è¡¨é¸å–®çµ„ä»¶ -->
      <ListMenu 
        :list-id="list.id"
        @add-card="handleAddCard"
        @delete-list="handleDeleteList"
      />
    </div>
    
    <!-- å¯æ‹–æ‹‰çš„å¡ç‰‡å®¹å™¨ -->
    <draggable
      class="min-h-5"
      :list="list.cards"
      group="cards"
      tag="div"
      @change="$emit('card-move', $event)"
    >
      <div v-for="card in list.cards" :key="card.id">
        <Card :card="card" @open-modal="$emit('open-card-modal', card)" />
      </div>
    </draggable>
    
    <!-- æ–°å¢å¡ç‰‡æŒ‰éˆ• -->
    <button 
      class="w-full p-3 bg-transparent border-2 border-dashed border-gray-300 rounded text-gray-600 cursor-pointer text-sm mt-2 transition-all duration-200 hover:bg-gray-100 hover:border-gray-400 hover:text-gray-800" 
      @click="handleAddCard"
    >
      + æ–°å¢å¡ç‰‡
    </button>
  </div>
</template>

<script setup lang="ts">
import Card from '@/components/Card.vue'
import ListMenu from '@/components/ListMenu.vue'
import { VueDraggableNext as draggable } from 'vue-draggable-next'
import { useListActions } from '@/composables/useListActions'
import { ref, nextTick } from 'vue'

// ä½¿ç”¨çµ±ä¸€çš„å‹åˆ¥å®šç¾©
import type { ListUI } from '@/types'
type List = ListUI

// çµ„ä»¶ props
const props = defineProps<{
  list: List
}>()

// çµ„ä»¶ emit äº‹ä»¶
defineEmits<{
  'card-move': [event: any]
  'open-card-modal': [card: any]
}>()

// ä½¿ç”¨åˆ—è¡¨æ“ä½œé‚è¼¯ - é€é composable çµ±ä¸€è™•ç†æ‰€æœ‰åˆ—è¡¨ç›¸é—œæ“ä½œ
const { addCard, deleteList, updateListTitle } = useListActions()

// ç·¨è¼¯ç‹€æ…‹
const isEditingTitle = ref(false)
const editingTitle = ref('')
const titleInput = ref<HTMLInputElement | null>(null)

// è™•ç†æ–°å¢å¡ç‰‡
const handleAddCard = () => {
  addCard(props.list.id)
}

// è™•ç†åˆªé™¤åˆ—è¡¨
const handleDeleteList = () => {
  deleteList(props.list.id)
}

// é–‹å§‹ç·¨è¼¯æ¨™é¡Œ
const startEditTitle = async () => {
  isEditingTitle.value = true
  editingTitle.value = props.list.title
  
  // ç­‰å¾… DOM æ›´æ–°å¾Œèšç„¦ä¸¦å…¨é¸æ–‡å­—
  await nextTick()
  if (titleInput.value) {
    titleInput.value.focus()
    titleInput.value.select()
  }
}

// å„²å­˜æ¨™é¡Œè®Šæ›´ - é€é composable çµ±ä¸€è™•ç†
const saveTitle = async () => {
  if (editingTitle.value.trim() && editingTitle.value.trim() !== props.list.title) {
    try {
      await updateListTitle(props.list.id, editingTitle.value.trim())
    } catch (error) {
      console.error('æ›´æ–°åˆ—è¡¨æ¨™é¡Œå¤±æ•—:', error)
      // å¤±æ•—æ™‚æ¢å¾©åŸå§‹æ¨™é¡Œ
      editingTitle.value = props.list.title
    }
  }
  isEditingTitle.value = false
}

// å–æ¶ˆç·¨è¼¯
const cancelEdit = () => {
  editingTitle.value = props.list.title
  isEditingTitle.value = false
}
</script>