<!--
  ğŸ“‹ ListItem çµ„ä»¶ - çœ‹æ¿åˆ—è¡¨çµ„ä»¶ (Trello Clone æ ¸å¿ƒçµ„ä»¶ä¹‹ä¸€)
  
  ğŸ¯ çµ„ä»¶ä¸»è¦åŠŸèƒ½ï¼š
  âœ… æ¸²æŸ“å–®ä¸€çœ‹æ¿åˆ—è¡¨åŠå…¶æ‰€æœ‰å¡ç‰‡
  âœ… æ”¯æ´åˆ—è¡¨æ¨™é¡Œçš„å³æ™‚ç·¨è¼¯åŠŸèƒ½ (é»æ“Šæ¨™é¡Œå¯ç·¨è¼¯ï¼ŒæŒ‰ Enter å„²å­˜ï¼ŒæŒ‰ Esc å–æ¶ˆ)
  âœ… ç®¡ç†å¡ç‰‡çš„æ‹–æ‹½æ’åºåŠŸèƒ½ (åŒåˆ—è¡¨å…§ç§»å‹• + è·¨åˆ—è¡¨ç§»å‹•)
  âœ… æä¾›åˆ—è¡¨æ“ä½œé¸å–® (æ–°å¢å¡ç‰‡ã€åˆªé™¤åˆ—è¡¨)
  âœ… è™•ç†å¡ç‰‡çš„æ–°å¢å’Œé–‹å•Ÿç·¨è¼¯åŠŸèƒ½
  âœ… æ•´åˆäº‹ä»¶é€šè¨Šç³»çµ±ï¼Œå°‡æ“ä½œå‚³éçµ¦çˆ¶çµ„ä»¶
  
  ğŸ”§ ä½¿ç”¨çš„æŠ€è¡“æ£§ï¼š
  - Vue 3 Composition API
  - VueDraggableNext (æ‹–æ‹½åŠŸèƒ½)
  - è‡ªè¨‚ useListActions composable (æ¥­å‹™é‚è¼¯æŠ½è±¡å±¤)
  - TypeScript å‹åˆ¥å®‰å…¨
  - Tailwind CSS æ¨£å¼
  
  ğŸ“¦ Props åƒæ•¸ï¼š
  - list: ListUI - åˆ—è¡¨è³‡æ–™ç‰©ä»¶ï¼ŒåŒ…å« idã€titleã€positionã€cards ç­‰æ¬„ä½
  
  ğŸš€ Emit äº‹ä»¶ï¼š
  - card-move: ç•¶å¡ç‰‡è¢«æ‹–æ‹½ç§»å‹•æ™‚è§¸ç™¼ï¼Œå‚³éæ‹–æ‹½äº‹ä»¶è³‡æ–™çµ¦çˆ¶çµ„ä»¶è™•ç†
  - open-card-modal: ç•¶é»æ“Šå¡ç‰‡è¦é–‹å•Ÿç·¨è¼¯æ¨¡æ…‹æ¡†æ™‚è§¸ç™¼ï¼Œå‚³éå¡ç‰‡è³‡æ–™çµ¦çˆ¶çµ„ä»¶
  
  ğŸ—ï¸ å­çµ„ä»¶çµæ§‹ï¼š
  - Card.vue: æ¸²æŸ“å–®ä¸€å¡ç‰‡ï¼Œè™•ç†å¡ç‰‡é¡¯ç¤ºå’Œé»æ“Šäº‹ä»¶
  - ListMenu.vue: æ¸²æŸ“ä¸‰é»é¸å–®ï¼Œæä¾›åˆ—è¡¨æ“ä½œåŠŸèƒ½ (æ–°å¢å¡ç‰‡ã€åˆªé™¤åˆ—è¡¨)
  
  ğŸ’¡ æ ¸å¿ƒäº¤äº’é‚è¼¯ï¼š
  1. åˆ—è¡¨æ¨™é¡Œç·¨è¼¯ï¼šé»æ“Šæ¨™é¡Œ â†’ è®Šæˆè¼¸å…¥æ¡† â†’ Enter å„²å­˜ / Esc å–æ¶ˆ / å¤±ç„¦å„²å­˜
  2. å¡ç‰‡æ‹–æ‹½ç§»å‹•ï¼šä½¿ç”¨ VueDraggableNextï¼Œæ”¯æ´åŒåˆ—è¡¨æ’åºå’Œè·¨åˆ—è¡¨ç§»å‹•
  3. æ–°å¢å¡ç‰‡ï¼šé»æ“Šåº•éƒ¨æŒ‰éˆ•æˆ–é¸å–®é …ç›® â†’ å‘¼å« useListActions.addCard()
  4. åˆªé™¤åˆ—è¡¨ï¼šé€šéé¸å–® â†’ å‘¼å« useListActions.deleteList()
  5. é–‹å•Ÿå¡ç‰‡ç·¨è¼¯ï¼šé»æ“Šå¡ç‰‡ â†’ emit äº‹ä»¶çµ¦çˆ¶çµ„ä»¶é–‹å•Ÿæ¨¡æ…‹æ¡†
  
  ğŸ¯ SOLID åŸå‰‡è¨­è¨ˆèªªæ˜ï¼š
  
  âœ… S (Single Responsibility) - å–®ä¸€è·è²¬åŸå‰‡
     åªè² è²¬ã€Œå–®å€‹åˆ—è¡¨ã€çš„æ¸²æŸ“å’ŒåŸºæœ¬äº’å‹•ï¼Œä¸è™•ç†æ•´é«”çœ‹æ¿é‚è¼¯
     æ¨™é¡Œç·¨è¼¯ã€å¡ç‰‡ç®¡ç†ã€é¸å–®æ“ä½œå„è‡ªç¨ç«‹ï¼Œè·è²¬æ¸…æ™°åˆ†é›¢
     
  âœ… O (Open/Closed) - é–‹æ”¾å°é–‰åŸå‰‡
     è¦æ–°å¢åˆ—è¡¨åŠŸèƒ½æ™‚ï¼Œé€é emit äº‹ä»¶å’Œ useListActions æ“´å±•
     ä¸éœ€è¦ä¿®æ”¹æ­¤çµ„ä»¶çš„æ ¸å¿ƒé‚è¼¯ï¼Œç¬¦åˆå°æ“´å±•é–‹æ”¾ã€å°ä¿®æ”¹å°é–‰
     
  âœ… L (Liskov Substitution) - é‡Œæ°æ›¿æ›åŸå‰‡
     çµ„ä»¶æ¥å— ListUI å‹åˆ¥ï¼Œä»»ä½•ç¬¦åˆæ­¤ä»‹é¢çš„åˆ—è¡¨ç‰©ä»¶éƒ½å¯ä»¥æ­£å¸¸é‹ä½œ
     ä¸æœƒå› ç‚ºåˆ—è¡¨è³‡æ–™çš„ç´°å¾®å·®ç•°è€Œå°è‡´çµ„ä»¶åŠŸèƒ½ç•°å¸¸
     
  âœ… I (Interface Segregation) - ä»‹é¢éš”é›¢åŸå‰‡
     åªä¾è³´æ‰€éœ€çš„ props å’Œ emit äº‹ä»¶ï¼Œä¸å¼·è¿«ä½¿ç”¨è€…å¯¦ä½œä¸éœ€è¦çš„ä»‹é¢
     useListActions åªæš´éœ²æ­¤çµ„ä»¶å¯¦éš›éœ€è¦çš„æ–¹æ³•
     
  âœ… D (Dependency Inversion) - ä¾è³´åè½‰åŸå‰‡  
     ä¸ç›´æ¥ä¾è³´ boardStoreï¼Œè€Œæ˜¯é€é useListActions æŠ½è±¡å±¤
     çµ„ä»¶ä¾è³´æŠ½è±¡ä»‹é¢ï¼Œä¸ä¾è³´å…·é«”å¯¦ä½œï¼Œæå‡å¯æ¸¬è©¦æ€§å’Œç¶­è­·æ€§
     
  ğŸ“ æ“´å±•æ–¹å¼ï¼š
     - æ–°å¢åˆ—è¡¨æ“ä½œï¼šåœ¨ useListActions åŠ å‡½æ•¸ï¼Œæ­¤çµ„ä»¶è‡ªå‹•å¯ç”¨
     - æ–°å¢ UI å…ƒç´ ï¼šåœ¨ ListMenu çµ„ä»¶åŠ æŒ‰éˆ•ï¼Œæ­¤çµ„ä»¶æ¥æ”¶ emit äº‹ä»¶
     - æ–°å¢å¡ç‰‡åŠŸèƒ½ï¼šä¿®æ”¹ Card çµ„ä»¶ï¼Œæ­¤çµ„ä»¶è‡ªå‹•ç¹¼æ‰¿æ–°åŠŸèƒ½
     - ä¿®æ”¹æ‹–æ‹½è¡Œç‚ºï¼šèª¿æ•´ draggable çµ„ä»¶çš„è¨­å®šï¼Œä¸å½±éŸ¿å…¶ä»–é‚è¼¯
  
  ğŸ§ª æ¸¬è©¦è¦†è“‹ï¼š
     çµ„ä»¶å·²æœ‰å®Œæ•´çš„å–®å…ƒæ¸¬è©¦è¦†è“‹ï¼ŒåŒ…å«æ‹–æ‹½åŠŸèƒ½ã€äº‹ä»¶è™•ç†ã€ç·¨è¼¯åŠŸèƒ½ç­‰
     æ¸¬è©¦æ–‡ä»¶ï¼štests/unit/components/CardDragDrop.test.ts (åŒ…å« ListItem æ¸¬è©¦)
  
  ğŸ“Š æ•ˆèƒ½è€ƒé‡ï¼š
     - ä½¿ç”¨ Vue 3 éŸ¿æ‡‰å¼ç³»çµ±ï¼Œåªåœ¨å¿…è¦æ™‚é‡æ–°æ¸²æŸ“
     - æ‹–æ‹½åŠŸèƒ½ä½¿ç”¨è™›æ“¬ DOM æœ€ä½³åŒ–ï¼Œæ”¯æ´å¤§é‡å¡ç‰‡çš„é †æš¢ç§»å‹•
     - äº‹ä»¶è™•ç†ä½¿ç”¨ event.stopPropagation() é¿å…ä¸å¿…è¦çš„äº‹ä»¶å†’æ³¡
  
  ğŸ”„ ç‹€æ…‹ç®¡ç†ï¼š
     - æœ¬åœ°ç‹€æ…‹ï¼šåˆ—è¡¨æ¨™é¡Œç·¨è¼¯ç‹€æ…‹ (isEditingTitle, editingTitle)
     - å…¨åŸŸç‹€æ…‹ï¼šé€é useListActions èˆ‡ boardStore äº’å‹•
     - éŸ¿æ‡‰å¼æ›´æ–°ï¼šç•¶ boardStore è³‡æ–™è®Šæ›´æ™‚ï¼Œçµ„ä»¶è‡ªå‹•é‡æ–°æ¸²æŸ“

  ğŸ› æ‹–æ‹½å¡ä½å•é¡Œçš„è§£æ±ºæ–¹æ¡ˆï¼š

  ğŸ“‹ å•é¡Œæè¿°ï¼š
  - æ‹–æ‹½å¡ç‰‡æ™‚æœ‰æ™‚æœƒå¡ä½ï¼Œç„¡æ³•æ­£å¸¸ç§»å‹•
  - æ‹–æ‹½éç¨‹ä¸­æœƒå‡ºç¾è—è‰²é‚Šæ¡†ï¼Œç„¶å¾Œå¡ä½ä¸å‹•

  ğŸ” æ ¹æœ¬åŸå› åˆ†æï¼š
  1. Focus ç‹€æ…‹å¹²æ“¾ï¼šç•¶æ‹–æ‹½é–‹å§‹æ™‚ï¼Œç€è¦½å™¨æœƒçµ¦å…ƒç´ åŠ ä¸Š focus ç‹€æ…‹
  2. äº‹ä»¶ç«¶çˆ­ï¼šfocus äº‹ä»¶èˆ‡æ‹–æ‹½åº«çš„ mouse äº‹ä»¶ç™¼ç”Ÿè¡çª
  3. æ¨£å¼è¨ˆç®—å»¶é²ï¼šè¤‡é›œçš„ CSSï¼ˆç‰¹åˆ¥æ˜¯ outlineï¼‰æœƒå°è‡´ä½ˆå±€é‡æ–°è¨ˆç®—ï¼Œæ‰“æ–·æ‹–æ‹½æµæš¢æ€§
  4. ç‹€æ…‹æ®˜ç•™ï¼šæ‹–æ‹½çµæŸå¾Œæ²’æœ‰æ­£ç¢ºæ¸…ç† sortable é¡åˆ¥ï¼Œå°è‡´ä¸‹æ¬¡æ‹–æ‹½æ™‚è¡çª

  âœ… è§£æ±ºæ–¹æ¡ˆï¼š
  1. é—œéµä¿®æ­£ - blur() å¤§æ³•ï¼š
     åœ¨ handleDragStart å’Œ handleChoose ä¸­ç«‹å³å‘¼å« blur() ç§»é™¤ focus ç‹€æ…‹
  
  2. ç‹€æ…‹æ¸…ç†ï¼š
     åœ¨ handleDragEnd ä¸­ç§»é™¤æ®˜ç•™çš„ sortable é¡åˆ¥ï¼Œé˜²æ­¢ä¸‹æ¬¡æ‹–æ‹½è¡çª
  
  3. é˜²æ­¢æ–‡å­—é¸å–å¹²æ“¾ï¼š
     æ‹–æ‹½æ™‚è¨­å®š document.body.style.userSelect = 'none'
  
  4. æ¸¸æ¨™å„ªåŒ–ï¼š
     ä½¿ç”¨ cursor: grab å’Œ cursor: grabbing æä¾›æ›´å¥½çš„è¦–è¦ºå›é¥‹

  ğŸ’¡ é—œéµæ´å¯Ÿï¼š
  - è—è‰²é‚Šæ¡†æœ¬èº«ä¸æ˜¯å•é¡Œï¼ŒçœŸæ­£çš„å•é¡Œæ˜¯èƒŒå¾Œçš„ focus ç‹€æ…‹
  - è§£æ±ºæ–¹æ¡ˆçš„æ ¸å¿ƒæ˜¯ç§»é™¤ focus ç‹€æ…‹ï¼Œè€Œä¸æ˜¯å¼·åˆ¶è¦†è“‹è¦–è¦ºæ¨£å¼
  - ä¿æŒè‡ªç„¶çš„ CSS æ¨£å¼å„ªå…ˆç´šï¼Œé¿å…éåº¦ä½¿ç”¨ !important

  ğŸ¨ è¦–è¦ºæ•ˆæœè¨­è¨ˆï¼š
  - é¸ä¸­ç‹€æ…‹ï¼šè—è‰²é‚Šæ¡† + è¼•å¾®æ”¾å¤§
  - æ‹–æ‹½ä¸­ï¼šç¶ è‰²é‚Šæ¡† + æ—‹è½‰ 2 åº¦ + å¼·åŒ–é™°å½±
  - å ä½ç¬¦ï¼šè™›ç·šé‚Šæ¡† + åŠé€æ˜èƒŒæ™¯

  ğŸ“ å¯¦éš›ä½¿ç”¨çš„æ¨£å¼é¡åˆ¥ï¼š
  - chosenClass: card-chosen (é¸ä¸­æ™‚)
  - dragClass: card-dragging (æ‹–æ‹½ä¸­)
  - ghostClass: card-ghost (å ä½ç¬¦)
  - fallbackClass: card-fallback (è·Ÿéš¨æ»‘é¼ )
-->

<template>
  <!-- å–®å€‹åˆ—è¡¨å®¹å™¨ -->
  <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šå¦‚æœæœ‰æ‹–æ›³æŠŠæ‰‹ï¼Œå°±ä¸è¦ä¸Šé¢çš„åœ“è§’ï¼Œå› ç‚ºæŠŠæ‰‹å·²ç¶“æœ‰åœ“è§’äº† -->
  <div 
    :class="[
      'bg-gray-200 p-2 flex-shrink-0 flex flex-col',
      props.isMobile ? 'mobile-list-item rounded-b-lg' : 'w-80 rounded'
    ]" 
    :data-list-id="list.id"
  >
    <!-- åˆ—è¡¨æ¨™é¡Œå€åŸŸ -->
    <div class="cursor-pointer flex justify-between items-center p-2 mb-2 relative">
      <!-- éç·¨è¼¯ç‹€æ…‹ï¼šé¡¯ç¤ºæ¨™é¡Œ -->
      <h2 
        v-if="!isEditingTitle" 
        class="w-full text-base font-bold select-none cursor-pointer hover:bg-gray-100 px-2 py-1 rounded"
        @click="startEditTitle"
      >
        {{ list.title }}
      </h2>
      
      <!-- ç·¨è¼¯ç‹€æ…‹ï¼šé¡¯ç¤ºè¼¸å…¥æ¡† -->
      <input
        v-else
        ref="titleInput"
        v-model="editingTitle"
        class="w-full text-base font-bold bg-white border-2 border-blue-400 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all"
        @keydown.enter="saveTitle"
        @blur="saveTitle"
        @keydown.esc="cancelEdit"
      />
      
      <!-- åˆ—è¡¨é¸å–®çµ„ä»¶ -->
      <ListMenu 
        :list-id="list.id"
        @add-card="handleAddCard"
        @delete-list="handleDeleteList"
      />
    </div>
    
    <!-- ğŸ¤– AI ç”Ÿæˆä»»å‹™æŒ‰éˆ• -->
    <div class="px-2 mb-3">
      <button
        @click="handleAiGenerate"
        :class="[
          'w-full px-3 py-2 text-sm text-white rounded-lg flex items-center justify-center gap-2 shadow-md transition-all duration-200',
          isAiGenerating 
            ? 'ai-rainbow-magic cursor-wait' 
            : 'bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 hover:shadow-lg'
        ]"
        :disabled="isAiGenerating"
      >
        <svg 
          :class="[
            'w-4 h-4',
            isAiGenerating ? 'animate-spin' : ''
          ]" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
        <span>
          {{ isAiGenerating ? 'ğŸŒˆ ç”Ÿæˆä¸­...' : 'ğŸ¤– AI ç”Ÿæˆä»»å‹™' }}
        </span>
      </button>
    </div>
    
    <!-- å¯æ‹–æ‹‰çš„å¡ç‰‡å®¹å™¨ -->
    <div class="flex-1 overflow-y-auto">
      <!-- ğŸ“± Vue Draggable Next å¡ç‰‡æ‹–æ‹½ç³»çµ± -->
      <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šé€™æ˜¯è®“å¡ç‰‡å¯ä»¥æ‹–ä¾†æ‹–å»çš„é­”æ³•ç©æœ¨ï¼ -->
        <!-- ğŸ¯  Fallback ç³»çµ±ï¼šæ‰‹æ©Ÿç‰ˆçš„æ•‘ä¸–ä¸»ï¼  -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šæ‰‹æ©Ÿç‰ˆç”¨ã€Œç‰¹æ®Šæ¨¡å¼ã€ï¼Œæ¡Œé›»ç‰ˆç”¨ã€Œä¸€èˆ¬æ¨¡å¼ã€ -->
        <!-- ğŸ” force-fallback = å¼·åˆ¶ä½¿ç”¨ fallback æ¨¡å¼ -->
        <!-- ğŸ’¡ æ‰‹æ©Ÿç‰ˆ = true (ç”¨æ¨è»Šæ¨¡å¼)ï¼Œæ¡Œé›»ç‰ˆ = false (ç”¨é™æ§è»Šæ¨¡å¼) -->
        <!-- ğŸ  fallback-on-body = æŠŠã€Œå½±åˆ†èº«ã€æ”¾åˆ°æ•´å€‹ç¶²é çš„æœ€ä¸Šå±¤ -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šåƒæŠŠå¡ç‰‡æ”¾åˆ°æœ€é«˜çš„æ¨“å±¤ï¼Œé€™æ¨£å°±ä¸æœƒè¢«å…¶ä»–æ±è¥¿æ“‹åˆ° -->
        <!-- ğŸ¯ fallback-tolerance = 0 = ç«‹åˆ»å•Ÿå‹• fallback æ¨¡å¼ -->
        <!-- ğŸ’¡ æ•¸å­—è¶Šå° = åæ‡‰è¶Šå¿«ï¼Œ0 = ç¬é–“å•Ÿå‹• -->
        <!-- â° å»¶é²ç³»çµ±ï¼šé˜²æ­¢èª¤è§¸ -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šæ‰‹æ©Ÿç‰ˆè¦ç­‰ 0.75 ç§’æ‰èƒ½æ‹–æ‹½ï¼ˆé¿å…æ‰‹æŠ–ï¼‰ï¼Œæ¡Œé›»ç‰ˆç«‹åˆ»å¯ä»¥æ‹– -->
        <!-- ğŸ–±ï¸ åªæœ‰ã€Œè§¸æ§ã€æ‰éœ€è¦å»¶é²ï¼Œæ»‘é¼ ä¸ç”¨ç­‰ -->
        <!-- ğŸ’¡ å› ç‚ºæ»‘é¼ å¾ˆç²¾æº–ï¼Œæ‰‹æŒ‡å®¹æ˜“èª¤è§¸ -->
        <!-- ğŸ“ è§¸æ§æ•æ„Ÿåº¦ï¼šæ‰‹æŒ‡è‡³å°‘è¦ç§»å‹• 10 åƒç´ æ‰ç®—æ‹–æ‹½ -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šé¿å…æ‰‹æŒ‡è¼•å¾®æŠ–å‹•å°±é–‹å§‹æ‹–æ‹½ï¼Œè¦ç§»å‹•ä¸€é»é»æ‰ç®—æ•¸ -->
        
        <!-- ğŸ¬ å‹•ç•«è¨­å®š -->
        <!-- âš¡ å‹•ç•«æ™‚é–“ï¼šå¡ç‰‡ç§»å‹•çš„é€Ÿåº¦ (200 æ¯«ç§’ = 0.2 ç§’) -->
        <!-- ğŸ’¡ æ•¸å­—è¶Šå° = å‹•ç•«è¶Šå¿«ï¼Œæ•¸å­—è¶Šå¤§ = å‹•ç•«è¶Šæ…¢ -->
        <!-- ğŸŒŠ å‹•ç•«æ›²ç·šï¼šæ§åˆ¶å‹•ç•«çš„ã€Œæ„Ÿè¦ºã€ -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šæ‰‹æ©Ÿç‰ˆç”¨ã€Œå½ˆæ€§æ„Ÿã€ï¼Œæ¡Œé›»ç‰ˆç”¨ã€Œç›´ç·šæ„Ÿã€ -->
        <!-- ğŸ’¡ å°±åƒå½ˆç  vs. æ¨ç©æœ¨çš„å·®åˆ¥ -->
        <!-- ğŸ¯ æ‹–æ‹½è¡Œç‚ºè¨­å®š -->
        <!-- ğŸ“œ æ»¾å‹•æ•æ„Ÿåº¦ï¼šæ‹–æ‹½åˆ°é‚Šç·£æ™‚ï¼Œå¤šå¿«é–‹å§‹æ»¾å‹•é é¢ -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šç•¶ä½ æ‹–å¡ç‰‡åˆ°è¢å¹•é‚Šç·£æ™‚ï¼Œé é¢æœƒè‡ªå‹•æ»¾å‹•å¹«ä½  -->
        <!-- ğŸ”„ äº¤æ›é–€æª»ï¼šæ‹–æ‹½å¤šå°‘æ¯”ä¾‹æ‰æœƒäº¤æ›ä½ç½® -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šè¦æ‹–éå¦ä¸€å¼µå¡ç‰‡çš„ 65% æ‰æœƒäº¤æ›ä½ç½® -->
        <!-- ğŸ’¡ ä¸æœƒæ‹–ä¸€é»é»å°±äº‚è·³ä½ç½® -->
        <!-- ğŸ«§ æ°£æ³¡æ»¾å‹•ï¼šå…è¨±æ»¾å‹•äº‹ä»¶å‘ä¸Šå‚³é -->
        <!-- ğŸ’¡ è®“æ»¾å‹•å¯ä»¥ç©¿é€åˆ°çˆ¶å…ƒç´  -->
        <!-- ğŸš« ä¸é˜»æ­¢éæ¿¾äº‹ä»¶ï¼šå…è¨±å…¶ä»–æ“ä½œ -->
        <!-- ğŸ¨ æ¨£å¼é¡åˆ¥ï¼šä¸åŒç‹€æ…‹çš„å¡ç‰‡é•·ä»€éº¼æ¨£å­ -->
        <!-- ğŸ­ æ‹–æ‹½ä¸­çš„å¡ç‰‡æ¨£å¼ (æ­£åœ¨è¢«æ‹–æ‹½çš„å¡ç‰‡) -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šæ­£åœ¨æ‹–æ‹½çš„å¡ç‰‡æœƒè®Šæˆä»€éº¼æ¨£å­ -->
        <!-- ğŸ‘» å¹½éˆå¡ç‰‡æ¨£å¼ (åŸä¾†ä½ç½®çš„å ä½ç¬¦) -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šåŸä¾†çš„ä½ç½®æœƒç•™ä¸€å€‹ã€Œå½±å­ã€å‘Šè¨´ä½ é€™è£¡ç©ºäº† -->
        <!-- âœ¨ è¢«é¸ä¸­çš„å¡ç‰‡æ¨£å¼ (é•·æŒ‰é¸ä¸­æ™‚) -->
        <!-- ğŸ’¡ åæ­²å°æœ‹å‹è§£é‡‹ï¼šå¡ç‰‡è¢«ã€Œé»åã€æ™‚æœƒç™¼å…‰ -->
        
      <draggable
        class="min-h-5"
        :list="list.cards"
        group="cards"
        @change="handleCardChange"
        tag="div"
        :disabled="false"
        :animation="200"
        :force-fallback="true"
        :fallback-on-body="true"
        :fallback-tolerance="0"
        ghostClass="card-ghost"
        chosenClass="card-chosen"
        dragClass="card-dragging"
        fallbackClass="card-fallback"
      >
        <div v-for="card in list.cards" :key="card.id" class="draggable-card-wrapper">
          <Card 
            :card="card" 
            :dragging="dragging"
            :is-mobile="props.isMobile"
            @open-modal="$emit('open-card-modal', card)"
            @update-title="(cardId, newTitle) => $emit('card-update-title', cardId, newTitle)"
            @update-status="(cardId, status) => handleCardStatusUpdate(cardId, status)"
            @update-priority="(cardId, priority) => handleCardPriorityUpdate(cardId, priority)"
          />
        </div>
      </draggable>
    </div>
    
    <!-- æ–°å¢å¡ç‰‡å€åŸŸ -->
    <div class="mt-2">
      <!-- é¡¯ç¤ºæŒ‰éˆ•æ¨¡å¼ -->
      <button 
        v-if="!isAddingCard"
        class="w-full p-3 bg-transparent border-2 border-dashed border-gray-300 rounded text-gray-600 cursor-pointer text-sm transition-all duration-200 hover:bg-gray-100 hover:border-gray-400 hover:text-gray-800" 
        @click="startAddCard"
      >
        + æ–°å¢å¡ç‰‡
      </button>
      
      <!-- é¡¯ç¤º inline ç·¨è¼¯æ¨¡å¼ -->
      <div 
        v-else
        class="bg-white rounded px-3 py-3 shadow-sm border"
      >
        <textarea
          ref="newCardInput"
          v-model="newCardTitle"
          placeholder="è¼¸å…¥é€™å¼µå¡ç‰‡çš„æ¨™é¡Œ..."
          class="w-full resize-none border-none outline-none text-sm min-h-14"
          @keydown.enter.prevent="saveNewCard"
          @keydown.escape="cancelAddCard"
        />
        <div class="flex gap-2 mt-2">
          <button
            @click="saveNewCard"
            :disabled="!newCardTitle.trim()"
            class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
          >
            æ–°å¢å¡ç‰‡
          </button>
          <button
            @click="cancelAddCard"
            class="px-3 py-1 text-gray-600 text-sm rounded hover:bg-gray-100"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
// #region â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“¦ IMPORTS & TYPES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¦ Vue æ ¸å¿ƒåŠŸèƒ½
import { ref, nextTick, computed } from 'vue'

// ğŸ  çµ„ä»¶å¼•å…¥
import Card from '@/components/Card.vue'
import ListMenu from '@/components/ListMenu.vue'

// ğŸ”Œ ç¬¬ä¸‰æ–¹å‡½åº«
import { VueDraggableNext as draggable } from 'vue-draggable-next'

// ğŸ”§ Composables å¼•å…¥
import { useCardActions } from '@/composables/useCardActions'
import { useInlineEdit } from '@/composables/useInlineEdit'
import { useDragAndDrop, type DragEvent, type DragItem } from '@/composables/useDragAndDrop'

// ğŸ“Š å‹åˆ¥å®šç¾©
import type { ListUI, CardUI } from '@/types'
import { CardStatus, CardPriority } from '@/types/api'


// #endregion â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“¦ IMPORTS & TYPES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// #region â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ¯ PROPS & EMITS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ ç´”æ¸²æŸ“çµ„ä»¶ï¼šæ¥æ”¶çˆ¶çµ„ä»¶å‚³å…¥çš„è³‡æ–™å’Œç‹€æ…‹
const props = defineProps<{
  list: ListUI
  dragging: boolean  // çˆ¶çµ„ä»¶æ§åˆ¶çš„æ‹–æ‹½ç‹€æ…‹
  isMobile?: boolean  // æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
  aiGeneratingListId?: string | null  // æ­£åœ¨ç”Ÿæˆ AI ä»»å‹™çš„åˆ—è¡¨ ID
}>()

// ğŸ¯ ç´”æ¸²æŸ“çµ„ä»¶ï¼šå®šç¾©äº‹ä»¶ (çˆ¶çµ„ä»¶è™•ç†é‚è¼¯)
const emit = defineEmits<{
  'card-move': [event: DragEvent]
  'open-card-modal': [card: CardUI]
  'drag-start': [item: DragItem, type: 'card' | 'list']
  'drag-end': []
  'card-update-title': [cardId: string, newTitle: string]
  'card-updated': []
  'list-add-card': [listId: string, title: string]
  'list-delete': [listId: string]
  'list-update-title': [listId: string, newTitle: string]
  'ai-generate': [listId: string]
}>()
// #endregion â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ¯ PROPS & EMITS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// #region â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ® COMPOSABLES & STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸŒˆ AI ç”Ÿæˆç‹€æ…‹æª¢æŸ¥
const isAiGenerating = computed(() => 
  props.aiGeneratingListId === props.list.id
)

// ğŸ“ åˆ—è¡¨æ¨™é¡Œç·¨è¼¯ Composable
const titleEdit = useInlineEdit({
  onSave: (newTitle) => {
    emit('list-update-title', props.list.id, newTitle)
  },
  defaultValue: props.list.title
})

// ğŸ“Œ æ–°å¢å¡ç‰‡ Composable
const cardAddEdit = useInlineEdit({
  onSave: (cardTitle) => {
    emit('list-add-card', props.list.id, cardTitle)
  },
  placeholder: 'è¼¸å…¥å¡ç‰‡æ¨™é¡Œ...'
})

// ğŸ”„ æ‹–æ‹½åŠŸèƒ½ Composable
const { startDrag, endDrag, handleCardDragMove } = useDragAndDrop()

// ğŸ“‹ å¡ç‰‡æ“ä½œ Composable
const { updateCardStatus, updateCardPriority } = useCardActions()

// ğŸ”— ç·¨è¼¯ç‹€æ…‹åˆ¥åï¼ˆä¿æŒç›¸å®¹æ€§ï¼‰
const isEditingTitle = titleEdit.isEditing
const editingTitle = titleEdit.editingValue
const titleInput = titleEdit.inputRef as any

const isAddingCard = cardAddEdit.isEditing
const newCardTitle = cardAddEdit.editingValue
const newCardInput = cardAddEdit.inputRef as any
// #endregion â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ® COMPOSABLES & STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// #region â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“ TITLE EDITING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// åˆ¥åå‡½æ•¸ï¼ˆä¿æŒç›¸å®¹æ€§ï¼‰
const startEditTitle = () => titleEdit.startEdit(props.list.title)
const saveTitle = titleEdit.saveEdit
const cancelEdit = titleEdit.cancelEdit
// #endregion â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“ TITLE EDITING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// #region â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“Œ CARD OPERATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Œ æ–°å¢å¡ç‰‡å‡½æ•¸
const handleAddCard = () => {
  console.log('ğŸ“Œ [PURE-LIST] æ–°å¢å¡ç‰‡äº‹ä»¶ï¼Œå§”æ´¾çµ¦çˆ¶çµ„ä»¶')
  cardAddEdit.startEdit()
}

// æ–°å¢å¡ç‰‡åˆ¥åå‡½æ•¸ï¼ˆä¿æŒç›¸å®¹æ€§ï¼‰
const startAddCard = cardAddEdit.startEdit
const saveNewCard = cardAddEdit.saveEdit
const cancelAddCard = cardAddEdit.cancelEdit
const isSavingCard = cardAddEdit.isSaving

// ğŸ”„ å¡ç‰‡ç‹€æ…‹æ›´æ–°
const handleCardStatusUpdate = async (cardId: string, status: CardStatus) => {
  console.log('ğŸ”„ [LIST-ITEM] æ›´æ–°å¡ç‰‡ç‹€æ…‹:', { cardId, status, statusType: typeof status })
  
  try {
    await updateCardStatus(cardId, status)
    console.log('âœ… [LIST-ITEM] ç‹€æ…‹æ›´æ–°æˆåŠŸ')
  } catch (error) {
    console.error('âŒ [LIST-ITEM] æ›´æ–°å¡ç‰‡ç‹€æ…‹å¤±æ•—:', error)
    emit('card-updated')
  }
}

// ğŸ† å¡ç‰‡å„ªå…ˆé †åºæ›´æ–°
const handleCardPriorityUpdate = async (cardId: string, priority: CardPriority) => {
  console.log('ğŸ”„ [LIST-ITEM] æ›´æ–°å¡ç‰‡å„ªå…ˆé †åº:', { cardId, priority, priorityType: typeof priority })
  
  try {
    await updateCardPriority(cardId, priority)
    console.log('âœ… [LIST-ITEM] å„ªå…ˆé †åºæ›´æ–°æˆåŠŸ')
  } catch (error) {
    console.error('âŒ [LIST-ITEM] æ›´æ–°å„ªå…ˆé †åºå¤±æ•—:', error)
    emit('card-updated')
  }
}
// #endregion â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ“Œ CARD OPERATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// #region â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ”„ DRAG & DROP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ æ‹–æ‹½è®Šæ›´äº‹ä»¶è™•ç†
const handleCardChange = async (event: any) => {
  console.log('ğŸ¯ [CARD-CHANGE] å¡ç‰‡è®Šæ›´äº‹ä»¶:', event)
  try {
    await handleCardDragMove(event, props.list.id)
    emit('card-move', event)
  } catch (error) {
    console.error('âŒ [CARD-CHANGE] è™•ç†å¡ç‰‡ç§»å‹•å¤±æ•—:', error)
  }
}

// #endregion â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ”„ DRAG & DROP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// #region â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ—‘ï¸ LIST OPERATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ—‘ï¸ åˆªé™¤åˆ—è¡¨å‡½æ•¸
const handleDeleteList = () => {
  console.log('ğŸ—‘ï¸ [PURE-LIST] åˆªé™¤åˆ—è¡¨äº‹ä»¶ï¼Œå§”æ´¾çµ¦çˆ¶çµ„ä»¶:', props.list.title)
  emit('list-delete', props.list.id)
}

// ğŸ¤– AI ç”Ÿæˆå‡½æ•¸
const handleAiGenerate = () => {
  console.log('ğŸ¤– [PURE-LIST] AI ç”Ÿæˆä»»å‹™äº‹ä»¶ï¼Œå§”æ´¾çµ¦çˆ¶çµ„ä»¶:', props.list.title)
  emit('ai-generate', props.list.id)
}
// #endregion â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ—‘ï¸ LIST OPERATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
</script>

<style scoped>
/* ğŸ¯ ä½¿ç”¨è‡ªå®šç¾© class åç¨±ï¼Œé¿å…å…¨åŸŸ CSS è¡çª */
.draggable-card-wrapper {
  width: 100%;
}

/* ğŸ¨ æ‹–æ›³è¦–è¦ºæ•ˆæœ - å®‰å…¨ç‰ˆæœ¬ï¼Œä¸æœƒå¡ä½ */
.card-chosen .card-draggable {
  opacity: 0.8;
  border: 2px solid #10b981 !important;
  box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
}

.card-ghost .card-draggable {
  opacity: 0.4;
  background: #f3f4f6;
  border: 2px dashed #9ca3af !important;
  /* å ä½ç¬¦æ•ˆæœ */
}

.card-dragging .card-draggable {
  opacity: 0.9;
  border: 2px solid #10b981 !important;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
  background: rgba(255, 255, 255, 0.95);
  transform: rotate(2deg);  /* æ‹–æ›³æ™‚å‚¾æ–œ 2 åº¦ */
  /* è·Ÿè‘—æ»‘é¼ çš„åŠé€æ˜æ•ˆæœ */
}

/* ğŸ¯ è·Ÿè‘—æ»‘é¼ çš„é€æ˜å¡ç‰‡æ•ˆæœ - å®‰å…¨ç‰ˆæœ¬ */
.card-fallback {
  opacity: 0.8 !important;
  background: rgba(255, 255, 255, 0.95) !important;
  border: 2px solid #10b981 !important;
  border-radius: 8px !important;
  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3) !important;
  /* ä¸èƒ½è¨­å®š transformï¼Œæœƒå’Œ vue-draggable-next çš„ä½ç½®æ§åˆ¶è¡çª */
}

/* ğŸ–±ï¸ æ¸¸æ¨™ç‹€æ…‹ï¼šhover æ™‚é¡¯ç¤ºå¯æŠ“å–ï¼Œæ‹–æ‹½æ™‚é¡¯ç¤ºæ­£åœ¨æŠ“å– */
.card-draggable:hover {
  cursor: grab;
}

.card-draggable:active,
.card-draggable.dragging {
  cursor: grabbing;
}

/* ğŸŒˆ AI ç”ŸæˆæŒ‰éˆ•çš„å½©è™¹é­”æ³•å‹•ç•« */
.ai-rainbow-magic {
  background: linear-gradient(
    -45deg,
    #ff0000,  /* ç´… */
    #ff8000,  /* æ©˜ */
    #ffff00,  /* é»ƒ */
    #80ff00,  /* é»ƒç¶  */
    #00ff00,  /* ç¶  */
    #00ff80,  /* é’ç¶  */
    #00ffff,  /* é’ */
    #0080ff,  /* è— */
    #0000ff,  /* è—ç´« */
    #8000ff,  /* ç´« */
    #ff00ff,  /* æ´‹ç´… */
    #ff0080,  /* ç²‰ç´… */
    #ff0000   /* å›åˆ°ç´…è‰² */
  );
  background-size: 400% 400%;
  animation: rainbowFlow 4s ease-in-out infinite;
  position: relative;
  border: 2px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
}

/* ğŸŒŸ å½©è™¹å…‰æšˆæ•ˆæœ */
.ai-rainbow-magic::before {
  content: '';
  position: absolute;
  top: -3px;
  left: -3px;
  right: -3px;
  bottom: -3px;
  background: linear-gradient(
    -45deg,
    #ff0000,  /* ç´… */
    #ff8000,  /* æ©˜ */
    #ffff00,  /* é»ƒ */
    #80ff00,  /* é»ƒç¶  */
    #00ff00,  /* ç¶  */
    #00ff80,  /* é’ç¶  */
    #00ffff,  /* é’ */
    #0080ff,  /* è— */
    #0000ff,  /* è—ç´« */
    #8000ff,  /* ç´« */
    #ff00ff,  /* æ´‹ç´… */
    #ff0080,  /* ç²‰ç´… */
    #ff0000   /* å›åˆ°ç´…è‰² */
  );
  background-size: 400% 400%;
  border-radius: inherit;
  z-index: -1;
  animation: rainbowFlow 3s ease-in-out infinite;
  opacity: 0.7;
  filter: blur(8px);
}

/* ğŸŒŸ å…§éƒ¨é­”æ³•å…‰èŠ’æ•ˆæœ */
.ai-rainbow-magic::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 80%;
  height: 80%;
  background: radial-gradient(
    circle,
    rgba(255,255,255,0.3) 0%,
    rgba(255,255,255,0.1) 50%,
    transparent 70%
  );
  border-radius: inherit;
  transform: translate(-50%, -50%);
  animation: magicPulse 2s ease-in-out infinite;
  pointer-events: none;
}

/* ğŸŒˆ å½©è™¹æµå‹•å‹•ç•« - æ…¢é€Ÿæµæš¢è®ŠåŒ– */
@keyframes rainbowFlow {
  0% {
    background-position: 0% 50%;
    filter: brightness(1) saturate(1.2);
  }
  20% {
    background-position: 100% 50%;
    filter: brightness(1.1) saturate(1.4);
  }
  40% {
    background-position: 200% 50%;
    filter: brightness(1.2) saturate(1.6);
  }
  60% {
    background-position: 300% 50%;
    filter: brightness(1.1) saturate(1.4);
  }
  80% {
    background-position: 400% 50%;
    filter: brightness(1) saturate(1.2);
  }
  100% {
    background-position: 500% 50%;
    filter: brightness(1) saturate(1.2);
  }
}

/* âœ¨ å…§éƒ¨å…‰èŠ’è„ˆå‹•å‹•ç•« */
@keyframes magicPulse {
  0%, 100% {
    opacity: 0.3;
    transform: translate(-50%, -50%) scale(0.8);
  }
  50% {
    opacity: 0.6;
    transform: translate(-50%, -50%) scale(1.2);
  }
}

/* ğŸ­ ç¦ç”¨ç‹€æ…‹æ™‚çš„æ¨£å¼èª¿æ•´ */
.ai-rainbow-magic:disabled {
  cursor: wait;
  transform: none;
}

.ai-rainbow-magic:disabled:hover {
  transform: none;
}

</style>